/*! For license information please see chat-widget.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.EasyChatWidget=t():e.EasyChatWidget=t()}(this,(()=>{return e={954:e=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function l(){"use strict";l=function(){return n};var e,n={},i=Object.prototype,r=i.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function p(e,t,n,i){var r=t&&t.prototype instanceof y?t:y,a=Object.create(r.prototype),s=new A(i||[]);return o(a,"_invoke",{value:z(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var g="suspendedStart",m="suspendedYield",f="executing",v="completed",b={};function y(){}function w(){}function x(){}var k={};d(k,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(F([])));E&&E!==i&&r.call(E,s)&&(k=E);var C=x.prototype=y.prototype=Object.create(k);function L(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,n){function i(o,a,s,c){var l=h(e[o],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==t(d)&&r.call(d,"__await")?n.resolve(d.__await).then((function(e){i("next",e,s,c)}),(function(e){i("throw",e,s,c)})):n.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,t){function r(){return new n((function(n,r){i(e,t,n,r)}))}return a=a?a.then(r,r):r()}})}function z(t,n,i){var r=g;return function(o,a){if(r===f)throw Error("Generator is already running");if(r===v){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=H(s,i);if(c){if(c===b)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===g)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=f;var l=h(t,n,i);if("normal"===l.type){if(r=i.done?v:m,l.arg===b)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=v,i.method="throw",i.arg=l.arg)}}}function H(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,H(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),b;var o=h(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,b;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function F(n){if(n||""===n){var i=n[s];if(i)return i.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,a=function t(){for(;++o<n.length;)if(r.call(n,o))return t.value=n[o],t.done=!1,t;return t.value=e,t.done=!0,t};return a.next=a}}throw new TypeError(t(n)+" is not iterable")}return w.prototype=x,o(C,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=d(x,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,d(e,u,"GeneratorFunction")),e.prototype=Object.create(C),e},n.awrap=function(e){return{__await:e}},L(M.prototype),d(M.prototype,c,(function(){return this})),n.AsyncIterator=M,n.async=function(e,t,i,r,o){void 0===o&&(o=Promise);var a=new M(p(e,t,i,r),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(C),d(C,u,"Generator"),d(C,s,(function(){return this})),d(C,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},n.values=F,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(q),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),q(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;q(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:F(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),b}},n}function u(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){u(o,i,r,a,s,"next",e)}function s(e){u(o,i,r,a,s,"throw",e)}a(void 0)}))}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,m(i.key),i)}}function g(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,n||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}var f=function(){return g((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p(this,e),this.isWaitingForResponse=!1,this.initConfig(n),this.userManager=new v(this.config),this.storageManager=new b(this.userManager,this.config),this.ensureDependencies().then((function(){t.initializeWidget(),t.setupEventListeners(),t.storageManager.setWidget(t),t.loadChatHistory(),t.setupEraseButton()})),this.activeForm=null,w[this.config.position]||(console.warn('Invalid position "'.concat(this.config.position,'". Falling back to bottom-right.')),this.config.position="bottom-right")}),[{key:"initConfig",value:function(e){var t,n,i,r,o=function(e,t,n){var i=parseInt(e);return"".concat(Math.min(Math.max(i,t),n),"px")},a=function(e){return e?e.startsWith("//")?"".concat(window.location.protocol).concat(e):e.startsWith("/")?"".concat(window.location.origin).concat(e):e.startsWith("http")?e:"http://".concat(e):"http://localhost:7000/chat"};this.config={botName:e.botName||"Chat Assistant",botImage:e.botImage||'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"%3E%3Cpath fill="%23fff" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"%3E%3C/path%3E%3C/svg%3E',greeting:e.greeting||"Hello! How can I help you today?",placeholder:e.placeholder||"Type your message here...",primaryColor:e.primaryColor||"#0084ff",fontSize:function(e){var t;t="string"==typeof e?parseInt(e.replace("px","")):"number"==typeof e?e:14;var n=Math.min(Math.max(14,t),25);return"".concat(n,"px")}(e.fontSize||14),width:o(e.width||"400px",300,600),height:o(e.height||"600px",400,800),showTimestamp:e.showTimestamp||!1,enableTypingIndicator:!1!==e.enableTypingIndicator,enableMarkdown:!1!==e.enableMarkdown,enableHistory:!1!==e.enableHistory,maxHistoryLength:e.maxHistoryLength||100,enableTypewriter:!1!==e.enableTypewriter,typewriterSpeed:e.typewriterSpeed||{min:30,max:70},chips:e.chips||[],customStyles:e.customStyles||{},onInit:e.onInit||null,onMessage:e.onMessage||null,onError:e.onError||null,apiEndpoint:a(e.apiEndpoint),apiKey:e.apiKey||"",apiHeaders:e.apiHeaders||{"Content-Type":"application/json"},apiRequestFormat:e.apiRequestFormat||{query:"query",userId:"userId",domain:"domain"},apiResponseFormat:e.apiResponseFormat||{response:"response"},apiMethod:e.apiMethod||"POST",apiTimeout:e.apiTimeout||3e4,enableBackendHistory:!1!==e.enableBackendHistory,backendHistoryEndpoint:a(e.backendHistoryEndpoint),deleteEndpoint:a(e.deleteEndpoint)||"".concat(a(e.apiEndpoint).replace(/\/chat$/,""),"/delete-history"),separateSubpageHistory:e.separateSubpageHistory||!1,feedbackEndpoint:a(e.feedbackEndpoint)||"".concat(this.config.apiEndpoint,"/feedback"),hubspot:{enabled:(null===(t=e.hubspot)||void 0===t?void 0:t.enabled)||!1,portalId:(null===(n=e.hubspot)||void 0===n?void 0:n.portalId)||"",formGuid:(null===(i=e.hubspot)||void 0===i?void 0:i.formGuid)||"",triggerKeywords:(null===(r=e.hubspot)||void 0===r?void 0:r.triggerKeywords)||["pricing","demo","contact","quote","help","support"],formShownToUsers:new Set,formSubmittedUsers:new Set},position:e.position||"bottom-right",enableServerHistoryDelete:!0}}},{key:"updateFontSize",value:function(e){this.config.fontSize=e,document.documentElement.style.setProperty("--chat-message-font-size",e)}},{key:"ensureDependencies",value:(u=d(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.marked||!this.config.enableMarkdown){e.next=3;break}return e.next=3,this.loadScript("https://cdn.jsdelivr.net/npm/marked/marked.min.js");case 3:this.loadStyles();case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"loadScript",value:function(e){return new Promise((function(t,n){var i=document.createElement("script");i.src=e,i.async=!0,i.onload=t,i.onerror=n,document.head.appendChild(i)}))}},{key:"loadStyles",value:function(){var e=document.createElement("style");e.textContent="\n            :root {\n                --chat-primary-color: ".concat(this.config.primaryColor,";\n                --chat-message-font-size: ").concat(this.config.fontSize,";\n                --chat-width: ").concat(this.config.width,";\n                --chat-height: ").concat(this.config.height,";\n                --chat-toggle-size: 60px;\n                --chat-border-radius: 16px;\n                --chat-shadow: 0 5px 40px rgba(0,0,0,0.16);\n            }\n\n            * {\n                margin: 0;\n                padding: 0;\n                box-sizing: border-box;\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            }\n\n            body {\n                background-color: #f5f5f5;\n                min-height: 100vh;\n            }\n\n            /* Main Website Content */\n            .website-content {\n                padding: 2rem;\n                max-width: 1200px;\n                margin: 0 auto;\n            }\n\n            /* Chat Widget Container */\n            .chat-widget {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                z-index: 2147483647;\n            }\n\n            .chat-widget.left .chat-toggle {\n                left: 20px;\n                right: auto;\n            }\n\n            .chat-widget.left .chat-window {\n                left: 20px;\n                right: auto;\n            }\n\n            /* Chat Toggle Button */\n            .chat-toggle {\n                width: 60px;\n                height: 60px;\n                border-radius: 50%;\n                background: var(--chat-primary-color);\n                box-shadow: 0 2px 12px rgba(0,0,0,0.15);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: transform 0.3s ease;\n            }\n\n            .chat-toggle:hover {\n                transform: scale(1.1);\n            }\n\n            .chat-toggle img {\n                width: 30px;\n                height: 30px;\n            }\n\n            /* Chat Window */\n            .chat-window {\n                position: fixed;\n                bottom: 100px;\n                right: 20px;\n                width: var(--chat-width);\n                height: var(--chat-height);\n                background: white;\n                border-radius: var(--chat-border-radius);\n                box-shadow: var(--chat-shadow);\n                display: none;\n                flex-direction: column;\n                overflow: hidden;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                transform: translateY(20px);\n                opacity: 0;\n                font-size: var(--chat-font-size);\n                min-width: 300px;\n                max-width: 600px;\n                min-height: 400px;\n                max-height: 800px;\n                padding: 0;\n                box-sizing: border-box;\n                overscroll-behavior: contain;\n                -webkit-overflow-scrolling: touch;\n            }\n\n            .chat-window.active {\n                display: flex;\n                transform: translateY(0);\n                opacity: 1;\n                border-radius: var(--chat-border-radius);\n                overflow: hidden;\n            }\n\n            /* Chat Header */\n            .chat-header {\n                background: var(--chat-primary-color);\n                color: white;\n                padding: 1rem;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                width: 100%;\n                box-sizing: border-box;\n                position: relative;\n                margin: 0;\n                border-top-left-radius: inherit;\n                border-top-right-radius: inherit;\n            }\n\n            /* Fix for header background extending to edges */\n            .chat-header::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: -1px;\n                right: -1px;\n                bottom: 0;\n                background: var(--chat-primary-color);\n                z-index: -1;\n                border-top-left-radius: inherit;\n                border-top-right-radius: inherit;\n            }\n\n            .chat-header-title {\n                display: flex;\n                align-items: center;\n                gap: 0.5rem;\n                position: relative;\n                z-index: 1;\n            }\n\n            .chat-header-avatar {\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                background: white;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .chat-header-avatar img {\n                width: 33px;\n                height: 33px;\n                border-radius: 50%;\n            }\n\n            .chat-header-actions {\n                display: flex;\n                align-items: center;\n                gap: 0.5rem;\n                position: relative;\n                z-index: 1;\n            }\n\n            .erase-chat, .close-chat {\n                background: none;\n                border: none;\n                color: white;\n                cursor: pointer;\n                padding: 0.5rem;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .erase-chat img, .close-chat img {\n                width: 20px;\n                height: 20px;\n            }\n\n            /* Chat Messages */\n            .chat-messages {\n                flex: 1;\n                overflow-y: auto;\n                padding: 1rem;\n                display: flex;\n                flex-direction: column;\n                gap: 1rem;\n                overscroll-behavior: contain;\n                -webkit-overflow-scrolling: touch;\n                scroll-behavior: smooth;\n                scrollbar-width: thin;\n                scrollbar-color: rgba(0, 0, 0, 0.2) transparent;\n            }\n\n            .chat-messages::-webkit-scrollbar {\n                width: 6px;\n            }\n\n            .chat-messages::-webkit-scrollbar-track {\n                background: transparent;\n            }\n\n            .chat-messages::-webkit-scrollbar-thumb {\n                background-color: rgba(0, 0, 0, 0.2);\n                border-radius: 3px;\n            }\n\n            /* Prevent iOS rubber-band effect */\n            @supports (-webkit-touch-callout: none) {\n                .chat-window {\n                    height: -webkit-fill-available;\n                }\n                \n                .chat-messages {\n                    height: -webkit-fill-available;\n                }\n            }\n\n            .message {\n                max-width: 80%;\n                padding: 0.8rem 1rem;\n                border-radius: 1rem;\n                margin: 0.25rem 0;\n                font-size: calc(var(--chat-font-size) * 0.8);\n                transition: max-width 0.3s ease, padding 0.3s ease;\n            }\n\n            .message-row {\n                display: flex;\n                align-items: flex-start;\n                gap: 0.5rem;\n            }\n\n            /* Bot Message Styling */\n            .bot-message {\n                max-width: 80%;\n                padding: 1rem;\n                background: #f0f2f5;\n                border-radius: 1rem;\n                border-top-left-radius: 0;\n                font-size: 14px;\n                line-height: 1.5;\n                color: #000000;\n            }\n\n            .bot-message img {\n                max-width: 100%;\n                height: auto;\n                border-radius: 8px;\n                margin: 8px 0;\n                transition: min-height 0.3s ease;\n            }\n\n            .bot-message img[src=\"\"] {\n                display: none;\n            }\n\n            .bot-message a {\n                color: #0084ff;\n                text-decoration: none;\n            }\n\n            .bot-message a:hover {\n                text-decoration: underline;\n            }\n\n            /* User Message */\n            .user-message {\n                margin-left: auto;\n                background: var(--chat-primary-color);\n                color: white;\n                border-top-right-radius: 0;\n                text-align: left;\n            }\n\n            /* Markdown Content Styles */\n            .bot-message h1, .bot-message h2, .bot-message h3 {\n                margin: 16px 0 8px 0;\n            }\n\n            .bot-message p {\n                margin: 8px 0;\n            }\n\n            .bot-message ul, .bot-message ol {\n                margin: 8px 0;\n                padding-left: 20px;\n            }\n\n            .bot-message code {\n                background: rgba(0, 0, 0, 0.05);\n                padding: 2px 4px;\n                border-radius: 4px;\n                font-family: monospace;\n            }\n\n            .bot-message pre {\n                background: rgba(0, 0, 0, 0.05);\n                padding: 12px;\n                border-radius: 4px;\n                overflow-x: auto;\n            }\n\n            .bot-message blockquote {\n                border-left: 4px solid #0084ff;\n                margin: 8px 0;\n                padding-left: 12px;\n                color: #666;\n            }\n\n            /* Chat Input Container */\n            .chat-input-container {\n                padding: 1rem;\n                border-top: 1px solid #e4e6eb;\n            }\n\n            /* Suggestion Chips */\n            .suggestion-chips {\n                padding: 0.5rem;\n                display: flex;\n                gap: 0.5rem;\n                overflow-x: auto;\n                white-space: nowrap;\n                -webkit-overflow-scrolling: touch;\n                scroll-behavior: smooth;\n                scrollbar-width: auto;\n                scrollbar-color: #0084ff #f0f2f5;\n            }\n\n            .suggestion-chips::-webkit-scrollbar {\n                height: 6px;\n            }\n\n            .suggestion-chips::-webkit-scrollbar-track {\n                background: #f0f2f5;\n                border-radius: 3px;\n            }\n\n            .suggestion-chips::-webkit-scrollbar-thumb {\n                background: #0084ff;\n                border-radius: 3px;\n            }\n\n            .chat-input input {\n                -webkit-user-select: text !important; /* Allow text selection on Safari */\n                user-select: text !important;        /* Ensure text selection works */\n                -webkit-tap-highlight-color: transparent !important; /* Remove tap highlight on iOS/Android */\n                cursor: text !important;             /* Ensure text cursor appears */\n            }\n\n            .chat-input input:focus {\n                outline: 2px solid #007bff !important; /* Add a clear focus outline */\n                border-color: #007bff !important;     /* Change border color on focus */\n            }\n\n            /* Ensure active inputs remain functional */\n            .chat-input input.active {\n                user-select: text !important;        /* Ensure text selection */\n                -webkit-user-select: text !important; /* Support for Safari */\n            }\n\n            /* Keep inactive inputs styled properly */\n            .chat-input input:not(.active):focus {\n                outline: none !important;            /* Remove focus outline */\n                border-color: #e4e6eb !important;    /* Keep the border color default */\n            }\n\n            /* Prevent issues with z-index or visibility */\n            .chat-input input {\n                z-index: 1 !important;\n                visibility: visible !important;\n                pointer-events: auto !important;\n            }\n\n\n            .chip {\n                background: #e4e6eb;\n                padding: 0.5rem 1rem;\n                border-radius: 16px;\n                white-space: nowrap;\n                cursor: pointer;\n                transition: background 0.2s;\n            }\n\n            .chip:hover {\n                background: #d8dadf;\n            }\n\n            /* Chat Input */\n            .chat-input {\n                display: flex;\n                gap: 0.5rem;\n                margin-top: 12px;\n            }\n\n            .chat-input input {\n                flex: 1;\n                padding: 0.8rem 1rem;\n                border: 1px solid #e4e6eb;\n                border-radius: 20px;\n                outline: none;\n                font-size: 14px;\n                background-color: white;\n                cursor: pointer;\n            }\n\n            .chat-input input.cursor-active {\n                cursor: text;\n                user-select: text;\n                -webkit-user-select: text;\n            }\n\n            .chat-input input:focus {\n                border-color: #0084ff;\n            }\n\n            .send-button {\n                background: var(--chat-primary-color);\n                color: white;\n                border: none;\n                border-radius: 50%;\n                width: 40px;\n                height: 40px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: background 0.2s;\n                margin-top: 3px;\n            }\n\n            .send-button:hover {\n                background: var(--chat-primary-color);\n                opacity: 0.9;\n            }\n\n            .send-button img {\n                width: 20px;\n                height: 20px;\n            }\n\n            /* Loading Animation */\n            .typing-indicator {\n                display: none;\n                padding: 0.5rem 1rem;\n                background: #f0f2f5;\n                border-radius: 1rem;\n                align-self: flex-start;\n                margin: 0.5rem 0;\n            }\n\n            .typing-indicator span {\n                width: 8px;\n                height: 8px;\n                background: #90949c;\n                display: inline-block;\n                border-radius: 50%;\n                margin: 0 2px;\n                animation: bounce 1.4s infinite ease-in-out;\n            }\n\n            .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n            .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n            @keyframes bounce {\n                0%, 80%, 100% { transform: scale(0); }\n                40% { transform: scale(1); }\n            }\n\n            /* Output Styles */\n            #output {\n                white-space: pre-wrap;\n                font-family: Arial, sans-serif;\n                line-height: 1.5;\n            }\n\n            #output img {\n                max-width: 100%;\n                height: auto;\n            }\n\n            #output code {\n                background-color: #f4f4f4;\n                padding: 2px 4px;\n                border-radius: 3px;\n            }\n\n            /* Dark Theme */\n            .chat-widget.dark {\n                --chat-bg-color: #1a1a1a;\n                --chat-text-color: #ffffff;\n                --chat-message-bg: #2d2d2d;\n                --chat-bot-message-bg: #383838;\n                --chat-input-bg: #2d2d2d;\n                --chat-input-border: #404040;\n            }\n\n            .chat-widget.dark .chat-window {\n                background: var(--chat-bg-color);\n                color: var(--chat-text-color);\n            }\n\n            .chat-widget.dark .message {\n                background: var(--chat-message-bg);\n                color: var(--chat-text-color);\n            }\n\n            .chat-widget.dark .bot-message {\n                background: #2d2d2d;\n                color: #ffffff;\n            }\n\n            .chat-widget.dark .chat-input input {\n                background: var(--chat-input-bg);\n                color: var(--chat-text-color);\n                border-color: var(--chat-input-border);\n            }\n\n            /* Initial greeting message style */\n            .greeting-message {\n                background: #e3f2fd !important;\n                border-left: 3px solid var(--chat-primary-color);\n                color: #000000 !important;\n            }\n\n            /* Responsive Design */\n            /* Mobile Portrait */\n            @media screen and (max-width: 480px) {\n                :root {\n                --chat-toggle-size: 50px;\n                }\n\n                .chat-input input {\n                    -webkit-user-select: text !important; /* Allow text selection on Safari */\n                    user-select: text !important;        /* Ensure text selection works */\n                    -webkit-tap-highlight-color: transparent !important; /* Remove tap highlight on iOS/Android */\n                    cursor: text !important;             /* Ensure text cursor appears */\n                }\n\n                .chat-input input:focus {\n                    outline: 2px solid #007bff !important; /* Add a clear focus outline */\n                    border-color: #007bff !important;     /* Change border color on focus */\n                }\n\n                /* Ensure active inputs remain functional */\n                .chat-input input.active {\n                    user-select: text !important;        /* Ensure text selection */\n                    -webkit-user-select: text !important; /* Support for Safari */\n                }\n\n                /* Keep inactive inputs styled properly */\n                .chat-input input:not(.active):focus {\n                    outline: none !important;            /* Remove focus outline */\n                    border-color: #e4e6eb !important;    /* Keep the border color default */\n                }\n\n                /* Prevent issues with z-index or visibility */\n                .chat-input input {\n                    z-index: 1 !important;\n                    visibility: visible !important;\n                    pointer-events: auto !important;\n                }\n\n            \n                .chat-window {\n                bottom: 0;\n                right: 0;\n                left: 0;\n                width: 100%;\n                height: 100vh;\n                border-radius: 0;\n                max-height: calc(100vh - env(safe-area-inset-bottom));\n                }\n            \n                .chat-toggle {\n                bottom: 10px;\n                right: 10px;\n                }\n            \n                .chat-header {\n                padding: 0.8rem;\n                }\n            \n                .chat-messages {\n                padding: 0.8rem;\n                }\n            \n                .chat-input-container {\n                padding: 0.8rem;\n                padding-bottom: max(0.8rem, env(safe-area-inset-bottom));\n                }\n            \n                .message {\n                max-width: 85%;\n                padding: 0.7rem;\n                }\n            \n                .suggestion-chips {\n                padding: 0.5rem 0;\n                }\n            \n                .chip {\n                padding: 0.4rem 0.8rem;\n                font-size: 0.9rem;\n                }\n            }\n            \n            /* Mobile Landscape */\n            @media screen and (max-height: 500px) and (orientation: landscape) {\n                .chat-window {\n                height: 100vh;\n                max-height: calc(100vh - 20px);\n                }\n\n                .chat-input input {\n                    -webkit-user-select: text !important; /* Allow text selection on Safari */\n                    user-select: text !important;        /* Ensure text selection works */\n                    -webkit-tap-highlight-color: transparent !important; /* Remove tap highlight on iOS/Android */\n                    cursor: text !important;             /* Ensure text cursor appears */\n                }\n\n                .chat-input input:focus {\n                    outline: 2px solid #007bff !important; /* Add a clear focus outline */\n                    border-color: #007bff !important;     /* Change border color on focus */\n                }\n\n                /* Ensure active inputs remain functional */\n                .chat-input input.active {\n                    user-select: text !important;        /* Ensure text selection */\n                    -webkit-user-select: text !important; /* Support for Safari */\n                }\n\n                /* Keep inactive inputs styled properly */\n                .chat-input input:not(.active):focus {\n                    outline: none !important;            /* Remove focus outline */\n                    border-color: #e4e6eb !important;    /* Keep the border color default */\n                }\n\n                /* Prevent issues with z-index or visibility */\n                .chat-input input {\n                    z-index: 1 !important;\n                    visibility: visible !important;\n                    pointer-events: auto !important;\n                }\n\n            \n                .chat-messages {\n                flex: 1;\n                max-height: calc(100vh - 180px);\n                }\n            \n                .suggestion-chips {\n                padding: 0.3rem 0;\n                }\n            \n                .chip {\n                padding: 0.3rem 0.6rem;\n                }\n            \n                .chat-input-container {\n                padding: 0.5rem;\n                }\n                .chat-input input {\n                    -webkit-user-select: none; /* For Safari */\n                    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on iOS */\n                }\n\n                .chat-input input.active {\n                    user-select: text; /* Allow text selection when active */\n                    -webkit-user-select: text; /* For Safari */\n                }\n\n                /* Prevent any focus styling until activated */\n                .chat-input input:not(.active):focus {\n                    outline: none;\n                    border-color: #e4e6eb; /* Keep default border */\n                }\n            }\n            \n            /* Tablet Portrait */\n            @media screen and (min-width: 481px) and (max-width: 768px) {\n                .chat-window {\n                width: 380px;\n                height: 520px;\n                bottom: 80px;\n                right: 10px;\n                }\n            \n                .chat-toggle {\n                bottom: 15px;\n                right: 15px;\n                }\n                .chat-input input {\n                    user-select: text;\n                    -webkit-user-select: text;\n                }\n            }\n            \n            /* Tablet Landscape */\n            @media screen and (min-width: 769px) and (max-width: 1024px) {\n                .chat-window {\n                width: 420px;\n                height: 580px;\n                }\n            }\n            \n            /* Desktop */\n            @media screen and (min-width: 1025px) and (max-width: 1919px) {\n                .chat-window {\n                width: 425px;\n                height: 600px;\n                }\n            }\n            \n            /* Large Desktop (1920px and above) */\n            @media screen and (min-width: 1920px) {\n                .chat-window {\n                width: 500px;\n                height: 700px;\n                }\n                \n                .chat-messages {\n                font-size: 1.1em;\n                }\n                \n                .chat-input input {\n                font-size: 1em;\n                padding: 1rem 1.2rem;\n                }\n                \n                .send-button {\n                width: 48px;\n                height: 48px;\n                }\n                \n                .chat-header {\n                padding: 1.2rem;\n                }\n            }\n            \n            /* 4K Displays */\n            @media screen and (min-width: 2560px) {\n                .chat-window {\n                width: 600px;\n                height: 800px;\n                }\n                \n                .chat-messages {\n                font-size: 1.2em;\n                }\n                \n                .chat-input input {\n                font-size: 1.1em;\n                padding: 1.2rem 1.4rem;\n                }\n                \n                .send-button {\n                width: 52px;\n                height: 52px;\n                }\n                \n                .chat-header {\n                padding: 1.4rem;\n                }\n            }\n\n            @media screen and (min-width: 1930px) {\n                .chat-window {\n                width: 450px;\n                height: 600px;\n                }\n            }\n\n            .hubspot-form-container {\n                transition: opacity 0.3s ease, transform 0.3s ease;\n            }\n\n            .chat-input-container.disabled {\n                opacity: 0.7;\n                pointer-events: none;\n            }\n\n            .chat-input-container.disabled::after {\n                content: 'Please complete the form above';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: var(--chat-primary-color);\n                opacity: 0.8;\n            }\n\n            .hubspot-form-success {\n                transition: opacity 0.3s ease, transform 0.3s ease;\n                padding: 20px;\n                background: #d4edda;\n                border-radius: 8px;\n                text-align: center;\n            }\n\n            .chip {\n                transition: opacity 0.3s ease, pointer-events 0.3s ease;\n            }\n\n            .chat-input input,\n            .send-button {\n                transition: opacity 0.3s ease, background-color 0.3s ease;\n            }\n\n            /* Safe Area Insets for Modern Mobile Devices */\n            @supports (padding: max(0px)) {\n                .chat-window {\n                    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n                    // padding-right: max(1rem, env(safe-area-inset-right));\n                    // padding-left: max(1rem, env(safe-area-inset-left));\n                }\n\n                .chat-input-container {\n                    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n                }\n            }\n\n            /* High Contrast Mode */\n            @media (prefers-contrast: high) {\n                .chat-widget {\n                    --chat-primary-color: #000000;\n                    --chat-secondary-color: #ffffff;\n                }\n\n                .message {\n                    border: 2px solid #000000;\n                }\n            }\n\n            /* Reduced Motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chat-toggle,\n                .chat-window {\n                    transition: none;\n                }\n            }\n\n            /* Print Styles */\n            @media print {\n                .chat-widget {\n                    display: none;\n                }\n            }\n            ").concat(this.config.customStyles,"\n\n            /* Image Preview Styles */\n            .image-container {\n                position: relative;\n                margin: 8px 0;\n                border-radius: 8px;\n            }\n\n            .image-container img {\n                max-width: 100%;\n                height: auto;\n                display: block;\n                border-radius: 8px;\n            }\n\n            .image-container svg {\n                opacity: 0.7;\n            }\n\n            .fullscreen-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 2147483647;\n                padding: 20px;\n            }\n\n            .preview-container {\n                position: relative;\n                max-width: 90vw;\n                max-height: 90vh;\n            }\n\n            .preview-image {\n                max-width: 100%;\n                max-height: 90vh;\n                object-fit: contain;\n            }\n\n            .close-preview {\n                position: absolute;\n                top: -40px;\n                right: -40px;\n                background: none;\n                border: none;\n                color: white;\n                font-size: 32px;\n                cursor: pointer;\n                padding: 10px;\n                line-height: 1;\n            }\n\n            .close-preview:hover {\n                color: #ddd;\n            }\n\n            @media (max-width: 768px) {\n                .close-preview {\n                    top: -40px;\n                    right: 0;\n                }\n            }\n\n            /* Amazon Product Link Styles */\n            .amazon-product-link {\n                margin: 10px 0;\n            }\n\n            .amazon-button {\n                display: inline-flex;\n                align-items: center;\n                gap: 5px;\n                padding: 5px 10px;\n                border: 1px solid #007bff;\n                border-radius: 5px;\n                color: #007bff;\n                text-decoration: none;\n                transition: background-color 0.3s ease;\n            }\n\n            .amazon-button:hover {\n                background-color: #007bff;\n                color: #ffffff;\n            }\n\n            .amazon-icon {\n                width: 20px;\n                height: 20px;\n            }\n\n            .chat-input input.waiting {\n                background-color: #ffffff !important; /* Keep background white when waiting */\n                cursor: text !important; /* Keep text cursor */\n            }\n\n            .chat-input input:disabled {\n                background-color: #f5f5f5;\n                cursor: not-allowed;\n            }\n\n            .send-button:disabled {\n                cursor: not-allowed;\n                opacity: 0.5;\n            }\n\n            .chat-input-container.waiting::after {\n                content: 'Processing...';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: var(--chat-primary-color);\n                opacity: 0.7;\n            }\n\n            /* Keep default font size for chat input */\n            .chat-input input {\n                font-size: 14px; /* Fixed size */\n                padding: 0.8rem 1rem;\n                border: 1px solid #e4e6eb;\n                border-radius: 20px;\n                outline: none;\n            }\n\n            /* Apply custom font size only to messages */\n            .message.user-message,\n            .message.bot-message {\n                font-size: var(--chat-message-font-size);\n            }\n\n            /* Keep all other elements at their default size */\n            .chat-header,\n            .chat-header-title h2,\n            .chat-input-container,\n            .suggestion-chips,\n            .chip,\n            .send-button,\n            .close-chat,\n            .erase-chat {\n                font-size: 14px; /* Fixed size */\n            }\n\n            /* Ensure markdown content inside bot messages uses the custom font size */\n            .bot-message p,\n            .bot-message ul,\n            .bot-message ol,\n            .bot-message li {\n                font-size: var(--chat-message-font-size);\n            }\n\n            /* Keep code blocks slightly smaller than message text */\n            .bot-message code {\n                font-size: calc(var(--chat-message-font-size) * 0.9);\n            }\n\n            /* Keep headers in markdown proportional to message size */\n            .bot-message h1 { font-size: calc(var(--chat-message-font-size) * 1.5); }\n            .bot-message h2 { font-size: calc(var(--chat-message-font-size) * 1.3); }\n            .bot-message h3 { font-size: calc(var(--chat-message-font-size) * 1.1); }\n\n            .message-actions {\n                display: none;\n                gap: 8px;\n                margin-top: 8px;\n            }\n\n            .bot-message-container:hover .message-actions,\n            .bot-message-container.last .message-actions {\n                display: flex;\n            }\n\n            .message-action-btn {\n                background: none;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 4px 8px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                transition: all 0.2s ease;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                color: white;\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n            }\n\n            .bot-message-container {\n                display: flex;\n                flex-direction: column;\n            }\n\n            /* Message Actions Container */\n            .message-actions {\n                display: none;  /* Hidden by default */\n                gap: 8px;\n                margin-top: 8px;\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n\n            /* Show actions on container hover */\n            .bot-message-container:hover .message-actions {\n                display: flex;\n                opacity: 1;\n            }\n\n            /* Always show actions for last message */\n            .bot-message-container.last .message-actions {\n                display: flex !important;\n                opacity: 1;\n            }\n\n            .message-action-btn {\n                background: #ffffff;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 6px 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                transition: all 0.2s ease;\n                font-size: 12px;\n                color: #666;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n                border-color: #d4d4d4;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                color: white;\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn.active img {\n                filter: brightness(0) invert(1);\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n                opacity: 0.7;\n            }\n\n            .bot-message-container {\n                display: flex;\n                flex-direction: column;\n            }\n\n            /* Copied tooltip */\n            .copy-btn.copied::after {\n                content: 'Copied!';\n                position: absolute;\n                top: -25px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 4px 8px;\n                border-radius: 4px;\n                font-size: 12px;\n                pointer-events: none;\n            }\n\n            .message-actions {\n                display: none;\n                gap: 4px;\n                margin-top: 4px;\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n\n            .bot-message-container:hover .message-actions {\n                display: flex;\n                opacity: 1;\n            }\n\n            .bot-message-container.last .message-actions {\n                display: flex !important;\n                opacity: 1;\n            }\n\n            .message-action-btn {\n                background: #ffffff;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 4px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n                width: 28px;\n                height: 28px;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n                border-color: #d4d4d4;\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n                opacity: 0.7;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn.active img {\n                opacity: 1;\n                filter: brightness(0) invert(1);\n            }\n\n            /* Copied tooltip */\n            .copy-btn.copied::after {\n                content: 'Copied!';\n                position: absolute;\n                top: -25px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 4px 8px;\n                border-radius: 4px;\n                font-size: 12px;\n                pointer-events: none;\n            }\n\n            /* Add powered by link styles */\n            .powered-by {\n                text-align: center;\n                padding: 0px;\n                font-size: 12px;\n                color: #666;\n                // border-top: 1px solid #e4e6eb;\n            }\n\n            .powered-by a {\n                color: var(--chat-primary-color);\n                text-decoration: none;\n                font-weight: 500;\n            }\n\n            .powered-by a:hover {\n                text-decoration: underline;\n            }\n\n            /* Base chat widget positioning */\n            .chat-widget {\n                position: fixed;\n                z-index: 2147483647;\n            }\n\n            /* Position-specific styles for toggle and window */\n            .chat-widget.bottom-right .chat-toggle {\n                bottom: 20px;\n                right: 20px;\n            }\n            .chat-widget.bottom-right .chat-window {\n                bottom: 100px;\n                right: 20px;\n            }\n\n            .chat-widget.bottom-left .chat-toggle {\n                bottom: 20px;\n                left: 20px;\n            }\n            .chat-widget.bottom-left .chat-window {\n                bottom: 100px;\n                left: 20px;\n            }\n\n            .chat-widget.bottom-center .chat-toggle {\n                bottom: 20px;\n                left: 50%;\n                transform: translateX(-50%)\n            }\n            .chat-widget.bottom-center .chat-window {\n                bottom: 100px;\n                left: 50%;\n                transform: translateX(-50%)\n            }\n\n            .chat-widget.top .chat-toggle {\n                top: 20px;\n                left: 50%;\n                transform: translateX(-50%)\n            }\n            .chat-widget.top .chat-window {\n                top: 100px;\n                left: 50%;\n                transform: translateX(-50%)\n            }\n\n            .chat-widget.left .chat-toggle {\n                left: 20px;\n                top: 50%;\n                transform: translateY(-50%)\n            }\n            .chat-widget.left .chat-window {\n                left: 20px;\n                top: 50%;\n                transform: translateY(-50%)\n            }\n\n            .chat-widget.right .chat-toggle {\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%)\n            }\n            .chat-widget.right .chat-window {\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%)\n            }\n\n            .chat-widget.top-right .chat-toggle {\n                top: 20px;\n                right: 20px;\n            }\n            .chat-widget.top-right .chat-window {\n                top: 100px;\n                right: 20px;\n            }\n\n            .chat-widget.top-left .chat-toggle {\n                top: 20px;\n                left: 20px;\n            }\n            .chat-widget.top-left .chat-window {\n                top: 100px;\n                left: 20px;\n            }\n\n            /* Mobile adjustments */\n            @media screen and (max-width: 480px) {\n                .chat-widget .chat-window {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    width: 100% !important;\n                    height: 100% !important;\n                    transform: none !important;\n                }\n            }\n\n            /* Only show cursor when input is specifically activated */\n            .chat-input input.cursor-active {\n                user-select: text;\n                -webkit-user-select: text;\n            }\n        ");var t=document.getElementById("chat-widget-styles");t&&t.remove(),document.head.appendChild(e)}},{key:"createWidget",value:function(){var e=document.createElement("div");e.className="chat-widget ".concat(this.config.theme," ").concat(this.config.position);var t=w[this.config.position],n=Object.entries(t.toggle).map((function(e){var t=a(e,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i,";")})).join(" "),i='\n            <div class="chat-toggle" style="position: fixed; '.concat(n,"\">\n                <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z'/%3E%3C/svg%3E\" alt=\"Chat\">\n            </div>\n        "),r=Object.entries(t.window).map((function(e){var t=a(e,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i,";")})).join(" "),o='\n            <div class="chat-window" style="position: fixed; '.concat(r,'">\n                <div class="chat-header">\n                    <div class="chat-header-title">\n                        <div class="chat-header-avatar">\n                            <img src="').concat(this.config.botImage,'" alt="').concat(this.config.botName,'" class="bot-avatar">\n                        </div>\n                        <h2 style="font-weight: bold; font-size: 20px;">').concat(this.config.botName,'</h2>\n                    </div>\n                    <div class="chat-header-actions">\n                        <button class="erase-chat">\n                            <img src="https://i.ibb.co.com/9YP3swm/erase.png" alt="Erase" title="Clear chat history">\n                        </button>\n                        <button class="close-chat">\n                            <img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\'/%3E%3C/svg%3E" alt="Close" title="Close chat">\n                        </button>\n                    </div>\n                </div>\n\n                <div class="chat-messages">\n                    <div class="message-row" id="greeting-row">\n                        <div class="message bot-message greeting-message">\n                            ').concat(this.config.greeting,'\n                        </div>\n                    </div>\n                    <div class="typing-indicator">\n                        <span>●</span><span>●</span><span>●</span>\n                    </div>\n                </div>\n\n                ').concat(this.config.chips.length>0?'\n                    <div class="suggestion-chips">\n                        '.concat(this.config.chips.map((function(e){return'\n                            <div class="chip">'.concat(e,"</div>\n                        ")})).join(""),"\n                    </div>\n                "):"",'\n\n                <div class="chat-input-container">\n                    <div class="chat-input">\n                        <input type="text" placeholder="').concat(this.config.placeholder,'" aria-label="Chat input">\n                        <button class="send-button">\n                            <img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\'/%3E%3C/svg%3E" alt="Send">\n                        </button>\n                    </div>\n                </div>\n                \x3c!--<div class="powered-by">\n                   Powered by <a href="https://neurobrains.co" target="_blank">NeuroBrain</a>\n                </div> --\x3e\n            </div>\n        ');e.innerHTML=i+o,document.body.appendChild(e),this.widget=e}},{key:"initializeWidget",value:function(){this.createWidget(),this.setupSuggestionChips(),this.setupResponsiveHandling(),this.setupScrollContainment(),console.log("Chat widget initialized.")}},{key:"setupEventListeners",value:function(){var e=this,t=this.widget.querySelector(".chat-toggle"),n=this.widget.querySelector(".chat-window"),i=this.widget.querySelector(".close-chat"),r=(this.widget.querySelector(".erase-chat"),this.widget.querySelector(".chat-messages")),o=this.widget.querySelector(".chat-input input"),a=this.widget.querySelector(".send-button"),s=(this.widget.querySelector(".typing-indicator"),function(e){t.innerHTML=e?"<img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z'/%3E%3C/svg%3E\" alt=\"Close\">":"<img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z'/%3E%3C/svg%3E\" alt=\"Chat\">"});t.addEventListener("click",(function(){n.classList.contains("active")?(n.classList.remove("active"),s(!1),setTimeout((function(){n.style.display="none"}),300)):(n.style.display="flex",s(!0),requestAnimationFrame((function(){n.classList.add("active"),window.innerWidth<=480&&setTimeout((function(){o.click(),o.removeAttribute("readonly");var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(e),/iPhone|iPad|iPod/i.test(navigator.userAgent)}),500)})))})),i.addEventListener("click",(function(){n.classList.remove("active"),s(!1),setTimeout((function(){n.style.display="none"}),300)}));var c=function(){var t=o.value.trim();!t||e.isWaitingForResponse||e.isTypewriterActive||e.sendMessage(t)};if(a.addEventListener("click",c),o.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())})),o.addEventListener("input",(function(){var t=!o.value.trim(),n=e.isWaitingForResponse||e.isTypewriterActive;a.disabled=t||n,a.style.opacity=a.disabled?"0.5":"1"})),document.addEventListener("click",(function(e){n.contains(e.target)||t.contains(e.target)||n.classList.contains("active")&&(n.classList.remove("active"),s(!1),setTimeout((function(){n.style.display="none"}),300))})),n.addEventListener("click",(function(e){e.stopPropagation()})),"ontouchstart"in window){var l=0,u=0;r.addEventListener("touchstart",(function(e){l=e.touches[0].clientY})),r.addEventListener("touchmove",(function(e){u=e.touches[0].clientY;var t=r.scrollTop,n=r.scrollHeight,i=r.clientHeight;0===t&&u>l&&e.preventDefault(),t+i>=n&&u<l&&e.preventDefault()}),{passive:!1})}window.addEventListener("resize",(function(){window.innerWidth<=480?n.style.height="".concat(window.innerHeight,"px"):n.style.height=""})),window.addEventListener("orientationchange",(function(){setTimeout((function(){window.innerWidth<=480&&(n.style.height="".concat(window.innerHeight,"px")),r.scrollTop=r.scrollHeight}),100)}));var d=document.createElement("style");if(d.textContent="\n            .chat-input input:disabled {\n                background-color: #f5f5f5;\n                cursor: not-allowed;\n            }\n            \n            .send-button:disabled {\n                cursor: not-allowed;\n            }\n            \n            .chat-input-container.waiting {\n                position: relative;\n            }\n            \n            .chat-input-container.waiting::after {\n                content: 'Waiting for response...';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: #666;\n            }\n        ",document.head.appendChild(d),window.innerWidth<=480){var p=this.widget.querySelector(".chat-input input"),h=this.widget.querySelector(".chat-input"),g=function(){p.classList.remove("cursor-active"),p.setAttribute("readonly","true")};h.addEventListener("click",(function(t){t.target!==h&&t.target!==p||(t.preventDefault(),e.isWaitingForResponse||e.isTypewriterActive||(p.classList.add("cursor-active"),p.removeAttribute("readonly")))})),p.addEventListener("touchstart",(function(e){p.classList.contains("cursor-active")||e.preventDefault()})),p.addEventListener("focus",(function(e){p.classList.contains("cursor-active")||(e.preventDefault(),g())})),p.addEventListener("blur",(function(){p.value||g()})),p.setAttribute("readonly","true")}}},{key:"setupSuggestionChips",value:function(){var e=this;this.widget.querySelectorAll(".chip").forEach((function(t){t.addEventListener("click",(function(){if(!e.isWaitingForResponse){var n=t.textContent;e.sendMessage(n),e.disableChips()}}))}));var t=document.createElement("style");t.textContent="\n            .chip {\n                transition: opacity 0.3s ease, background-color 0.3s ease;\n            }\n            \n            .chip.disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n                pointer-events: none;\n                background-color: #e0e0e0;\n            }\n        ",document.head.appendChild(t)}},{key:"disableChips",value:function(){this.widget.querySelectorAll(".chip").forEach((function(e){e.classList.add("disabled")}))}},{key:"enableChips",value:function(){this.widget.querySelectorAll(".chip").forEach((function(e){e.classList.remove("disabled")}))}},{key:"typeWriter",value:function(e,t,n){this.isTypewriterActive=!0,this.disableSendingFunctionality();var i=!1,r=0,o=this.widget.querySelector(".chat-messages"),a=function(){o.scrollTop<r&&(i=!0),r=o.scrollTop};o.addEventListener("scroll",a),e.innerHTML="";var s="",c=function(e){for(var t=[],n="",i=!1,r=!1,o=0;o<e.length;o++){var a=e[o];"<"!==a||r?">"===a&&i?(n+=a,t.push(n),n="",i=!1):i?n+=a:"*"===a&&"*"===e[o+1]?(n&&t.push(n),t.push("**"),o++,n=""):"["===a||"!"===a&&"["===e[o+1]?(n&&t.push(n),n=a,r=!0):r&&"]"===a&&"("===e[o+1]?(n+=a+"(",o++):r&&")"===a?(n+=a,t.push(n),n="",r=!1):" "===a||"\n"===a?(n&&t.push(n),t.push(a),n=""):(n+=a,r||i||o!==e.length-1&&" "!==e[o+1]&&"\n"!==e[o+1]||(t.push(n),n="")):(n&&t.push(n),n=a,i=!0)}return n&&t.push(n),t}(t),l=0;function u(){if(l>=c.length)return o.removeEventListener("scroll",a),this.isTypewriterActive=!1,this.enableSendingFunctionality(),void(n&&n());var t,r=c[l],d=r.startsWith("<")&&r.endsWith(">"),p=r.startsWith("**")||r.startsWith("[")||r.startsWith("![");s+=r,e.innerHTML=s,requestAnimationFrame((function(){var e,t,n,r;i||o.scrollHeight-o.scrollTop-o.clientHeight<100&&(o.scrollTop=o.scrollHeight),null===(e=event)||void 0===e||null===(t=e.preventDefault)||void 0===t||t.call(e),null===(n=event)||void 0===n||null===(r=n.stopPropagation)||void 0===r||r.call(n)})),l++,t=d||p?0:" "===r?20:"\n"===r?50:40*Math.random()+30,setTimeout(u,t)}(u=u.bind(this))()}},{key:"disableSendingFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),t=this.widget.querySelector(".send-button");e.readOnly=!1,t.disabled=!0,t.style.opacity="0.5",this.disableChips(),e.classList.add("waiting")}},{key:"enableSendingFunctionality",value:function(){if(!this.isWaitingForResponse&&!this.isTypewriterActive){var e=this.widget.querySelector(".chat-input input"),t=this.widget.querySelector(".send-button");e.readOnly=!1,t.disabled=!1,t.style.opacity="1",this.enableChips(),e.classList.remove("waiting")}}},{key:"addMessage",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.widget.querySelector(".chat-messages"),o=this.widget.querySelector(".typing-indicator"),a=document.createElement("div");if(a.className="message-row","bot"===t){var s=document.createElement("div");s.className="bot-message-container";var c=document.createElement("div");c.className="message ".concat(t,"-message");var l=document.createElement("div");l.className="message-actions",l.style.display="none",l.innerHTML="\n                <button class=\"message-action-btn copy-btn\" title=\"Copy to clipboard\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z'/%3E%3C/svg%3E\" alt=\"Copy\">\n                </button>\n                <button class=\"message-action-btn like-btn\" title=\"Helpful\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z'/%3E%3C/svg%3E\" alt=\"Like\">\n                </button>\n                <button class=\"message-action-btn dislike-btn\" title=\"Not helpful\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z'/%3E%3C/svg%3E\" alt=\"Dislike\">\n                </button>\n                <button class=\"message-action-btn regenerate-btn\" title=\"Regenerate response\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z'/%3E%3C/svg%3E\" alt=\"Regenerate\">\n                </button>\n            ",this.config.enableMarkdown&&"bot"===t?i&&this.config.enableTypewriter?(c.innerHTML="",this.typeWriter(c,marked.parse(e),(function(){l.style.display="flex",n.setupMessageLinks(c),n.scrollToTypingIndicator(),n.updateLastBotMessage(),n.checkForTriggerWords(e)&&setTimeout((function(){n.showHubSpotForm()}),500)}))):(c.innerHTML=marked.parse(e),l.style.display="flex",this.setupMessageLinks(c),this.checkForTriggerWords(e)&&this.showHubSpotForm()):(c.textContent=e,l.style.display="flex"),s.appendChild(c),s.appendChild(l),a.appendChild(s),this.setupMessageActions(s,e),this.checkForTriggerWords(e)&&(i&&this.config.enableTypewriter?this.typeWriter(c,marked.parse(e),(function(){n.showHubSpotForm()})):this.showHubSpotForm())}else{var u=document.createElement("div");u.className="message ".concat(t,"-message"),u.textContent=e,a.appendChild(u)}r.insertBefore(a,o),this.updateLastBotMessage()}},{key:"setupMessageLinks",value:function(e){e.querySelectorAll("a").forEach((function(e){e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")})),e.querySelectorAll("img").forEach((function(e){var t=document.createElement("div");t.className="image-container",e.parentNode.insertBefore(t,e),t.appendChild(e),e.addEventListener("error",(function(){t.innerHTML='\n                <svg width="50" height="50" viewBox="0 0 24 24" fill="#999">\n                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>\n                </svg>',t.style.padding="20px",t.style.textAlign="center"}))}))}},{key:"sendMessage",value:(c=d(l().mark((function e(t){var n,i,r,o,a,s,c,u,d,p=this,h=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]&&h[1],!this.isWaitingForResponse&&!this.isTypewriterActive){e.next=3;break}return e.abrupt("return");case 3:return i=this.widget.querySelector(".chat-input input"),r=this.widget.querySelector(".typing-indicator"),this.widget.querySelector(".chat-window"),o=function(){i.value="",i.setAttribute("readonly","true"),i.classList.remove("cursor-active"),p.isMobileBrowser()?setTimeout((function(){p.enableMobileInputInteraction(i)}),100):i.focus()},a=function(){p.isWaitingForResponse=!0,p.disableSendingFunctionality(),r.style.display="block"},s=function(){p.isWaitingForResponse=!1,p.enableSendingFunctionality(),r.style.display="none"},e.prev=9,a(),this.scrollToTypingIndicator(),n||(this.addMessage(t,"user"),this.storageManager.saveMessage(t,"user")),c=this.formatRequestData(t),e.next=16,this.makeApiCall(c);case 16:u=e.sent,d=this.config.transformResponse?this.config.transformResponse(u):u[this.config.apiResponseFormat.response],this.addMessage(d,"bot",!0),this.storageManager.saveMessage(d,"bot",n),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(9),console.error("API Error:",e.t0),this.addMessage("Sorry, there was an error processing your request.","bot",!1);case 26:return e.prev=26,s(),o(),e.finish(26);case 30:case"end":return e.stop()}}),e,this,[[9,22,26,30]])}))),function(e){return c.apply(this,arguments)})},{key:"isMobileBrowser",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}},{key:"enableMobileInputInteraction",value:function(e){var t,n=function(){e.removeAttribute("readonly"),e.classList.add("cursor-active"),setTimeout((function(){e.focus(),/iPhone|iPad|iPod/i.test(navigator.userAgent)&&e.setSelectionRange(e.value.length,e.value.length)}),100)};!function(){var e=document.createElement("style");e.textContent="\n                @media (max-width: 480px) {\n                    .chat-input input {\n                        -webkit-user-select: text !important;\n                        user-select: text !important;\n                        -webkit-touch-callout: default !important;\n                        cursor: text !important;\n                        caret-color: auto !important;\n                        font-size: 16px !important;\n                    }\n                    \n                    .chat-input input.cursor-active {\n                        pointer-events: auto !important;\n                        user-select: text !important;\n                        -webkit-user-select: text !important;\n                    }\n                    \n                    .chat-input input[readonly] {\n                        cursor: pointer !important;\n                        user-select: none;\n                        -webkit-user-select: none;\n                    }\n                    \n                    .chat-input input:focus {\n                        outline: none;\n                        caret-color: auto !important;\n                    }\n                }\n            ",document.head.appendChild(e)}(),t=function(e){e.preventDefault(),n()},e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("click",t),n()}},{key:"scrollToTypingIndicator",value:function(){var e=this.widget.querySelector(".chat-messages"),t=this.widget.querySelector(".typing-indicator");e&&t&&requestAnimationFrame((function(){var n={top:e.scrollHeight,behavior:"smooth"};e.scrollTo(n),t.scrollIntoView({behavior:"smooth",block:"end"})}))}},{key:"formatRequestData",value:function(e){var t=o(o(o({},this.config.apiRequestFormat.query,e),this.config.apiRequestFormat.userId,this.userManager.currentUser),this.config.apiRequestFormat.domain,this.userManager.domain);return this.config.transformRequest?this.config.transformRequest(t):t}},{key:"makeApiCall",value:(s=d(l().mark((function e(t){var n,i,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r({},this.config.apiHeaders),this.config.apiKey&&(n.Authorization="Bearer ".concat(this.config.apiKey)),i=new AbortController,o=setTimeout((function(){return i.abort()}),this.config.apiTimeout),e.prev=4,e.next=7,fetch(this.config.apiEndpoint,{method:this.config.apiMethod,headers:n,body:JSON.stringify(t),signal:i.signal});case 7:if((a=e.sent).ok){e.next=10;break}throw new Error("HTTP error! status: ".concat(a.status));case 10:return e.next=12,a.json();case 12:return s=e.sent,e.abrupt("return",s);case 14:return e.prev=14,clearTimeout(o),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[4,,14,17]])}))),function(e){return s.apply(this,arguments)})},{key:"processApiResponse",value:function(e,t){t.style.display="none";var n=this.config.transformResponse?this.config.transformResponse(e):e[this.config.apiResponseFormat.response];this.widget.querySelector(".chat-window").classList.add("active"),this.addMessage(n,"bot",!0),this.storageManager.saveMessage(n,"bot")}},{key:"handleApiError",value:function(e,t){console.error("API Error:",e),t.style.display="none";var n="Sorry, there was an error processing your request.";"AbortError"===e.name?n="Request timed out. Please try again.":e.message.includes("SSL_PROTOCOL_ERROR")?n="There was a secure connection error. Please ensure the server supports HTTPS.":e.message.includes("Failed to fetch")&&(n="Unable to connect to the server. Please check your internet connection and try again."),this.addMessage(n,"bot",!0),this.storageManager.saveMessage(n,"bot"),this.config.onError&&this.config.onError(e)}},{key:"updateUIForSending",value:function(e,t){this.addMessage(t.value.trim(),"user"),this.storageManager.saveMessage(t.value.trim(),"user"),t.value="",e.style.display="block",this.isWaitingForResponse=!0,this.disableSendingFunctionality()}},{key:"resetUIAfterSending",value:function(e){this.isWaitingForResponse=!1,this.isTypewriterActive||this.enableSendingFunctionality(),e.style.display="none"}},{key:"loadChatHistory",value:function(){var e=this;if(this.widget){var t=this.widget.querySelector(".chat-messages"),n=t.querySelectorAll(".message-row"),i=t.querySelector("#greeting-row");n.forEach((function(e){e!==i&&e.remove()})),this.storageManager.getChatHistory().reduce((function(e,t){if("user"===t.sender)e.push(t);else if("bot"===t.sender){var n=e.findLastIndex((function(e){return"user"===e.sender}));-1!==n&&(e=e.filter((function(e,t){return t<=n||"user"===e.sender}))),e.push(t)}return e}),[]).forEach((function(t){e.addMessage(t.message,t.sender,!1)}))}}},{key:"updateConfig",value:function(e){this.initConfig(r(r({},this.config),e)),this.destroy(),this.createWidget(),this.setupEventListeners(),this.loadChatHistory()}},{key:"destroy",value:function(){this.removeActiveForm()}},{key:"setupEraseButton",value:function(){var e=this.widget.querySelector(".erase-chat");e&&(e.removeEventListener("click",this.eraseChat.bind(this)),e.addEventListener("click",this.eraseChat.bind(this)))}},{key:"eraseChat",value:function(){if(confirm("Are you sure you want to clear the chat history? This action cannot be undone.")){var e=this.widget.querySelector(".erase-chat");e.style.opacity="0.5",e.disabled=!0;try{var t=this.widget.querySelector(".chat-messages"),n=t.querySelectorAll(".message-row");t.querySelector("#greeting-row"),n.forEach((function(e){"greeting-row"!==e.id&&e.remove()})),this.storageManager.clearHistory(),!0===this.config.enableServerHistoryDelete&&this.config.deleteEndpoint?(console.log("Attempting to delete server history..."),this.deleteBackendHistory().then((function(){console.log("Backend history deleted successfully")})).catch((function(e){console.error("Failed to delete backend history:",e)}))):console.log("Server history deletion skipped:",{enabled:this.config.enableServerHistoryDelete,hasEndpoint:Boolean(this.config.deleteEndpoint)}),t.querySelector("#greeting-row")||this.addGreetingMessage();var i=this.widget.querySelector(".chat-input input");i&&(i.value=""),console.log("Chat history cleared successfully")}catch(e){console.error("Error during chat erasure:",e),this.addMessage("Failed to clear chat history. Please try again.","bot",!1)}finally{e.style.opacity="1",e.disabled=!1}}}},{key:"addGreetingMessage",value:function(){var e=this.widget.querySelector(".chat-messages");if(!e.querySelector("#greeting-row")){var t=document.createElement("div");t.className="message-row",t.id="greeting-row";var n=document.createElement("div");n.className="message bot-message greeting-message",n.textContent=this.config.greeting,t.appendChild(n),e.insertBefore(t,e.firstChild)}}},{key:"setupResponsiveHandling",value:function(){var e=this,t=function(){var t=e.widget.querySelector(".chat-window"),n=e.widget.querySelector(".chat-toggle");if(t&&n){var i=function(){var e=window.innerHeight,t=window.innerWidth,n=Math.min(Math.max(.3*t,320),600),i=Math.min(Math.max(.7*e,400),800);t<=480?(n=t,i=e,i=e-parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")||"0")):t<=768?(n=Math.min(.8*t,400),i=Math.min(.8*e,600)):t<=1024?(n=Math.min(.35*t,420),i=Math.min(.7*e,580)):t<=1366?(n=Math.min(.3*t,450),i=Math.min(.75*e,600)):t<=1920?(n=Math.min(.25*t,500),i=Math.min(.8*e,700)):(n=Math.min(.2*t,600),i=Math.min(.8*e,800)),n=Math.max(n,320),i=Math.max(i,400);var r=e-(t<=480?0:120);return{width:n,height:i=Math.min(i,r)}}(),r=i.width,o=i.height,s=(window.innerHeight,window.innerWidth);if(t.style.width="".concat(r,"px"),t.style.height="".concat(o,"px"),s<=480)t.style.bottom="0",t.style.right="0",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.borderRadius="0",t.style.maxHeight="100%",t.style.transform="none";else{var c=w[e.config.position];Object.entries(c.window).forEach((function(e){var n=a(e,2),i=n[0],r=n[1];t.style[i]=r}))}var l=Math.min(Math.max(.04*r,14),16);t.style.fontSize="".concat(l,"px");var u=t.querySelector(".chat-messages"),d=t.querySelector(".chat-input-container");if(u){var p=Math.min(Math.max(.03*r,8),16);u.style.padding="".concat(p,"px");var h=t.querySelector(".chat-header").offsetHeight,g=d?d.offsetHeight:0;u.style.height="calc(100% - ".concat(h+g,"px)")}if(d){var m=Math.min(Math.max(.03*r,8),16);d.style.padding="".concat(m,"px")}}};!function(){var e=document.createElement("style");e.innerHTML="\n                :root {\n                    --sab: env(safe-area-inset-bottom);\n                    --sat: env(safe-area-inset-top);\n                    --sal: env(safe-area-inset-left);\n                    --sar: env(safe-area-inset-right);\n                }\n            ",document.head.appendChild(e)}(),t(),window.addEventListener("resize",y(t,250)),window.addEventListener("orientationchange",(function(){setTimeout(t,100)}));var n=new ResizeObserver(y((function(){var t=e.widget.querySelector(".chat-messages");t&&(t.scrollTop=t.scrollHeight)}),100)),i=this.widget.querySelector(".chat-window");i&&n.observe(i)}},{key:"scrollChatToBottom",value:function(){var e=this.widget.querySelector(".chat-messages");if(e){var t,n,i,r,o=e.scrollTop;e.scrollHeight-e.clientHeight-o<100&&(requestAnimationFrame((function(){e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})),null===(t=event)||void 0===t||null===(n=t.preventDefault)||void 0===n||n.call(t),null===(i=event)||void 0===i||null===(r=i.stopPropagation)||void 0===r||r.call(i))}}},{key:"setupScrollContainment",value:function(){var e=this.widget.querySelector(".chat-messages");if(e){e.addEventListener("wheel",(function(t){if(e.scrollHeight>e.clientHeight){t.stopPropagation();var n=t.deltaY<0,i=t.deltaY>0,r=0===e.scrollTop,o=e.scrollTop+e.clientHeight>=e.scrollHeight;(n&&r||i&&o)&&t.preventDefault()}}),{passive:!1});var t=0;e.addEventListener("touchstart",(function(e){t=e.touches[0].clientY}),{passive:!0}),e.addEventListener("touchmove",(function(n){var i=n.touches[0].clientY>t,r=e.scrollTop<=0,o=e.scrollTop+e.clientHeight>=e.scrollHeight;(i&&r||!i&&o)&&n.preventDefault()}),{passive:!1})}}},{key:"deleteBackendHistory",value:function(){var e=this.userManager.currentUser,t=this.userManager.domain;return fetch(this.config.deleteEndpoint,{method:"DELETE",headers:r(r({},this.config.apiHeaders),{},{"Content-Type":"application/json"}),body:JSON.stringify({userId:e,domain:t})}).then((function(e){if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.json()}))}},{key:"setupMessageActions",value:function(e,t){var n=this,i=e.querySelector(".copy-btn"),r=e.querySelector(".like-btn"),o=e.querySelector(".dislike-btn"),a=e.querySelector(".regenerate-btn"),s=e.querySelector(".bot-message");i.addEventListener("click",(function(){navigator.clipboard.writeText(s.textContent).then((function(){i.classList.add("copied"),i.innerHTML="\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E\" alt=\"✓\">\n                ",setTimeout((function(){i.classList.remove("copied"),i.innerHTML="\n                        <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z'/%3E%3C/svg%3E\" alt=\"Copy\">\n                    "}),2e3)}))})),r.addEventListener("click",(function(){var e=r.classList.contains("active");r.classList.remove("active"),o.classList.remove("active"),e?n.sendFeedback("remove",t):(r.classList.add("active"),n.sendFeedback("like",t))})),o.addEventListener("click",(function(){var e=o.classList.contains("active");r.classList.remove("active"),o.classList.remove("active"),e?n.sendFeedback("remove",t):(o.classList.add("active"),n.sendFeedback("dislike",t))})),a.addEventListener("click",d(l().mark((function t(){var i,r,o,a,s,c,u;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.isWaitingForResponse){t.next=21;break}i=Array.from(n.widget.querySelectorAll(".message-row")),r=i.findIndex((function(t){return t.contains(e)})),o="",a=-1,s=r-1;case 6:if(!(s>=0)){t.next=15;break}if(!(c=i[s].querySelector(".user-message"))){t.next=12;break}return o=c.textContent,a=s,t.abrupt("break",15);case 12:s--,t.next=6;break;case 15:if(!o||-1===a){t.next=21;break}for(u=i.length-1;u>a;u--)i[u].remove();return t.next=19,n.updateStorageAfterRegeneration(a,o);case 19:return t.next=21,n.sendMessage(o,!0);case 21:case"end":return t.stop()}}),t)}))))}},{key:"updateLastBotMessage",value:function(){var e=this.widget.querySelectorAll(".bot-message-container");e.forEach((function(t,n){t.classList.remove("last"),n===e.length-1&&t.classList.add("last")}))}},{key:"updateStorageAfterRegeneration",value:(i=d(l().mark((function e(t,n){var i,r,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.userManager.getHistoryKey(),r=this.storageManager.getChatHistory(),o=-1,a=-1,s=0;case 5:if(!(s<r.length)){e.next=14;break}if("user"!==r[s].sender){e.next=11;break}if(++a!==t){e.next=11;break}return o=s,e.abrupt("break",14);case 11:s++,e.next=5;break;case 14:-1!==o&&((r=r.slice(0,o+1))[o].regenerated=!0,localStorage.setItem(i,JSON.stringify(r)));case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"sendFeedback",value:(t=d(l().mark((function e(t,n){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i={type:t,response:n,feedback:null,timestamp:(new Date).toISOString(),userId:this.userManager.currentUser,domain:this.userManager.domain},e.next=4,fetch(this.config.feedbackEndpoint,{method:"POST",headers:r({"Content-Type":"application/json"},this.config.apiHeaders),body:JSON.stringify(i)});case 4:if(e.sent.ok){e.next=7;break}throw new Error("Failed to send feedback");case 7:this.saveFeedbackState(n,t),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error sending feedback:",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,n){return t.apply(this,arguments)})},{key:"saveFeedbackState",value:function(e,t){var n="feedback_".concat(this.userManager.currentUser),i=JSON.parse(localStorage.getItem(n)||"{}");"remove"===t?delete i[e]:i[e]=t,localStorage.setItem(n,JSON.stringify(i))}},{key:"restoreFeedbackState",value:function(e,t){var n="feedback_".concat(this.userManager.currentUser),i=JSON.parse(localStorage.getItem(n)||"{}")[t];if(i){var r=e.querySelector(".like-btn"),o=e.querySelector(".dislike-btn");"like"===i?(r.classList.add("active"),o.classList.remove("active")):"dislike"===i&&(o.classList.add("active"),r.classList.remove("active"))}}},{key:"checkForTriggerWords",value:function(e){var t;if(null===(t=this.config.hubspot)||void 0===t||!t.enabled)return!1;if(this.userManager.hasSubmittedForm())return!1;if(this.isFormActive())return!1;var n=e.toLowerCase().split(/\s+/);return this.config.hubspot.triggerKeywords.some((function(e){return n.includes(e.toLowerCase())}))}},{key:"isFormActive",value:function(){return!!this.activeForm||!!this.widget.querySelector(".hubspot-form-container")}},{key:"showHubSpotForm",value:function(){var e;if(null!==(e=this.config.hubspot)&&void 0!==e&&e.enabled&&!this.userManager.hasSubmittedForm()&&!this.isFormActive()){this.disableChatFunctionality(),this.widget.querySelectorAll(".hubspot-form-row").forEach((function(e){return e.remove()}));var t=document.createElement("div");t.className="message-row hubspot-form-row",t.innerHTML='\n            <div class="hubspot-form-container" style="opacity: 0; transform: translateY(20px);">\n                <div class="form-header">\n                    <h3>Contact Us</h3>\n                    <p>Please fill out the form below and we\'ll get back to you shortly.</p>\n                </div>\n                <form id="hubspotForm" class="hubspot-form">\n                    <div class="form-group">\n                        <label for="fullname">Full Name *</label>\n                        <input type="text" id="fullname" name="fullname" required \n                               placeholder="Enter your full name">\n                        <div id="fullname-error" class="error-message"></div>\n                    </div>\n                    <div class="form-group">\n                        <label for="email">Email Address *</label>\n                        <input type="email" id="email" name="email" required \n                               placeholder="Enter your email">\n                        <div id="email-error" class="error-message"></div>\n                    </div>\n                    <div class="form-group">\n                        <label for="phone">Phone Number *</label>\n                        <input type="tel" id="phone" name="phone" required \n                               placeholder="Enter your phone number">\n                        <div id="phone-error" class="error-message"></div>\n                    </div>\n                    <button type="submit" id="submitButton">Submit</button>\n                </form>\n            </div>\n        ';var n=this.widget.querySelector(".chat-messages"),i=this.widget.querySelector(".typing-indicator");n.insertBefore(t,i),this.activeForm=t;var r=document.createElement("style");r.textContent="\n            .hubspot-form-container {\n                background: #fff;\n                padding: 20px;\n                border-radius: 12px;\n                box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n                margin: 15px 0;\n                max-width: 100%;\n                border: 1px solid #e4e6eb;\n            }\n            \n            .form-header {\n                margin-bottom: 20px;\n                text-align: center;\n            }\n            \n            .form-header h3 {\n                margin: 0 0 8px 0;\n                color: #333;\n                font-size: 18px;\n            }\n            \n            .form-header p {\n                margin: 0;\n                color: #666;\n                font-size: 14px;\n            }\n            \n            .hubspot-form .form-group {\n                margin-bottom: 20px;\n            }\n            \n            .hubspot-form label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: 500;\n                color: #333;\n                font-size: 14px;\n            }\n            \n            .hubspot-form input {\n                width: 100%;\n                padding: 10px;\n                border: 1px solid #ddd;\n                border-radius: 6px;\n                font-size: 14px;\n                transition: border-color 0.3s ease;\n            }\n            \n            .hubspot-form input:focus {\n                outline: none;\n                border-color: var(--chat-primary-color);\n                box-shadow: 0 0 0 2px rgba(var(--chat-primary-color-rgb), 0.1);\n            }\n            \n            .hubspot-form input::placeholder {\n                color: #999;\n            }\n            \n            .hubspot-form .error-message {\n                color: #dc3545;\n                font-size: 12px;\n                margin-top: 4px;\n                min-height: 20px;\n            }\n            \n            .hubspot-form button {\n                background: var(--chat-primary-color);\n                color: white;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n                transition: all 0.3s ease;\n            }\n            \n            .hubspot-form button:hover {\n                opacity: 0.9;\n                transform: translateY(-1px);\n            }\n            \n            .hubspot-form button:disabled {\n                opacity: 0.6;\n                cursor: not-allowed;\n                transform: none;\n            }\n            \n            .hubspot-form-success {\n                text-align: center;\n                padding: 20px;\n                background: #d4edda;\n                border-radius: 8px;\n                color: #155724;\n                margin: 10px 0;\n            }\n        ",document.head.appendChild(r),requestAnimationFrame((function(){var e=t.querySelector(".hubspot-form-container");e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="1",e.style.transform="translateY(0)"})),setTimeout((function(){t.scrollIntoView({behavior:"smooth",block:"center"})}),100);var o=t.querySelector("#hubspotForm");this.setupHubSpotFormHandlers(o)}}},{key:"setupHubSpotFormHandlers",value:function(e){var t=this,n=function(e){return/^[A-Za-z]+\s+[A-Za-z]+(\s+[A-Za-z]+)?$/.test(e.trim())},i=function(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.trim())},r=function(e){var t=e.replace(/\D/g,"");return t.length>=7&&t.length<=20};e.querySelector("#fullname").addEventListener("input",(function(){e.querySelector("#fullname-error").textContent=n(this.value)?"":"Please enter your full name"})),e.querySelector("#email").addEventListener("input",(function(){e.querySelector("#email-error").textContent=i(this.value)?"":"Please enter a valid email"})),e.querySelector("#phone").addEventListener("input",(function(){e.querySelector("#phone-error").textContent=r(this.value)?"":"Please enter a valid phone number"})),e.addEventListener("submit",function(){var o=d(l().mark((function o(a){var s,c,u,d,p,h;return l().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a.preventDefault(),(s=e.querySelector("#submitButton")).disabled=!0,s.textContent="Submitting...",c=e.querySelector("#fullname").value,u=e.querySelector("#email").value,d=e.querySelector("#phone").value,n(c)&&i(u)&&r(d)){o.next=11;break}return s.disabled=!1,s.textContent="Submit",o.abrupt("return");case 11:return o.prev=11,o.next=14,t.submitToHubSpot({firstName:c.split(" ")[0],lastName:c.split(" ").slice(1).join(" "),email:u,phone:d.replace(/\D/g,"")});case 14:if(!o.sent.ok){o.next=22;break}t.userManager.recordFormSubmission({firstName:c.split(" ")[0],lastName:c.split(" ").slice(1).join(" "),email:u,phone:d.replace(/\D/g,"")}),t.activeForm=null,(p=t.widget.querySelector(".hubspot-form-container"))&&(p.style.transition="opacity 0.3s ease",p.style.opacity="0",setTimeout((function(){p.innerHTML='\n                                <div class="hubspot-form-success" style="opacity: 0; transform: translateY(10px)">\n                                    <h3>Thank you for your submission!</h3>\n                                    <p>We\'ll get back to you shortly.</p>\n                                </div>\n                            ',requestAnimationFrame((function(){var e=p.querySelector(".hubspot-form-success");e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="1",e.style.transform="translateY(0)"}))}),300),setTimeout((function(){t.enableChatFunctionality(),setTimeout((function(){var e=p.closest(".message-row");e&&(e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="0",e.style.transform="translateY(-20px)",setTimeout((function(){e.remove(),t.activeForm=null}),300))}),2e3)}),1e3)),o.next=23;break;case 22:throw new Error("Submission failed");case 23:o.next=34;break;case 25:o.prev=25,o.t0=o.catch(11),console.error("HubSpot submission error:",o.t0),s.textContent="Error - Try Again",s.disabled=!1,(h=document.createElement("div")).className="error-message",h.textContent="Failed to submit form. Please try again.",e.appendChild(h);case 34:case"end":return o.stop()}}),o,null,[[11,25]])})));return function(e){return o.apply(this,arguments)}}())}},{key:"submitToHubSpot",value:(e=d(l().mark((function e(t){var n,i,r,o,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.config.hubspot,i=n.portalId,r=n.formGuid,o="https://api.hsforms.com/submissions/v3/integration/submit/".concat(i,"/").concat(r),a={submittedAt:Date.now(),fields:[{name:"firstname",value:t.firstName},{name:"lastname",value:t.lastName},{name:"email",value:t.email},{name:"phone",value:t.phone}],context:{pageUri:window.location.href,pageName:document.title}},e.abrupt("return",fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}));case 4:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"disableChatFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),t=this.widget.querySelector(".send-button"),n=this.widget.querySelectorAll(".chip");e.disabled=!0,t.disabled=!0,n.forEach((function(e){e.style.opacity="0.5",e.style.pointerEvents="none"})),e.closest(".chat-input-container").classList.add("disabled")}},{key:"enableChatFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),t=this.widget.querySelector(".send-button"),i=this.widget.querySelectorAll(".chip");[e,t].concat(n(i)).forEach((function(e,t){setTimeout((function(){e.disabled=!1,e.style.opacity="1",e.style.pointerEvents="auto"}),100*t)})),e.closest(".chat-input-container").classList.remove("disabled")}},{key:"removeActiveForm",value:function(){this.activeForm&&(this.activeForm.remove(),this.activeForm=null,this.enableChatFunctionality())}}]);var e,t,i,s,c,u}(),v=function(){return g((function e(t){p(this,e),this.config=t,this.domain=this.getCurrentDomain(),this.path=this.getCurrentPath(),this.currentUser=this.generateUserId(),this.initializeUser(),this.formSubmissionsKey="chatFormSubmissions_".concat(this.domain),this.initializeFormSubmissions()}),[{key:"getCurrentDomain",value:function(){return window.location.hostname}},{key:"getCurrentPath",value:function(){return window.location.pathname}},{key:"generateUserId",value:function(){var e=this.config.separateSubpageHistory?"currentChatUser_".concat(this.domain).concat(this.path):"currentChatUser_".concat(this.domain),t=localStorage.getItem(e);if(!t){var n="user_".concat(this.domain).concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,5));return localStorage.setItem(e,n),n}return t}},{key:"getHistoryKey",value:function(){return this.config.separateSubpageHistory?"chatHistory_".concat(this.domain).concat(this.path):"chatHistory_".concat(this.domain)}},{key:"initializeUser",value:function(){var e=this.getHistoryKey();localStorage.getItem(e)||localStorage.setItem(e,JSON.stringify([]))}},{key:"initializeFormSubmissions",value:function(){localStorage.getItem(this.formSubmissionsKey)||localStorage.setItem(this.formSubmissionsKey,JSON.stringify([]))}},{key:"hasSubmittedForm",value:function(){return JSON.parse(localStorage.getItem(this.formSubmissionsKey)||"[]").includes(this.currentUser)}},{key:"recordFormSubmission",value:function(e){var t=JSON.parse(localStorage.getItem(this.formSubmissionsKey)||"[]");if(!t.includes(this.currentUser)){t.push(this.currentUser),localStorage.setItem(this.formSubmissionsKey,JSON.stringify(t));var n="chatFormData_".concat(this.currentUser);localStorage.setItem(n,JSON.stringify(r(r({},e),{},{submittedAt:(new Date).toISOString()})))}}},{key:"loadUserData",value:function(){var e=this.getHistoryKey();return{userId:this.currentUser,domain:this.domain,path:this.path,chatHistory:JSON.parse(localStorage.getItem(e))||[]}}}])}(),b=function(){return g((function e(t,n){p(this,e),this.userManager=t,this.config=n,this.maxHistoryLength=100,this.widget=null,this.domain=t.domain,this.path=t.path}),[{key:"setWidget",value:function(e){this.widget=e}},{key:"getChatHistory",value:function(){var e=this,t=this.userManager.getHistoryKey(),n=localStorage.getItem(t),i=n?JSON.parse(n):[];return this.config.separateSubpageHistory?i.filter((function(t){return!(t.domain&&t.domain!==e.domain||t.path&&t.path!==e.path)})):i.filter((function(t){return!t.domain||t.domain===e.domain}))}},{key:"saveMessage",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.userManager.getHistoryKey(),r=this.getChatHistory();if(n&&"bot"===t){var o=r.findLastIndex((function(e){return"user"===e.sender}));-1!==o&&(r=r.slice(0,o+1))}var a={message:e,sender:t,timestamp:(new Date).toISOString(),domain:this.domain,isRegenerated:n};this.config.separateSubpageHistory&&(a.path=this.path),r.push(a),r.length>this.maxHistoryLength&&(r=r.slice(-this.maxHistoryLength)),localStorage.setItem(i,JSON.stringify(r))}},{key:"loadChatHistory",value:function(){var e=this;if(this.widget){var t=this.widget.widget.querySelector(".chat-messages"),n=t.querySelectorAll(".message-row"),i=t.querySelector("#greeting-row");n.forEach((function(e){e!==i&&e.remove()})),this.getChatHistory().forEach((function(t){e.widget.addMessage(t.message,t.sender,!1)}))}}},{key:"clearHistory",value:function(){var e=this.userManager.getHistoryKey();try{localStorage.removeItem(e),localStorage.setItem(e,JSON.stringify([])),console.log("Local storage cleared successfully")}catch(e){console.error("Error clearing local storage:",e)}}}])}();function y(e,t){var n;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];clearTimeout(n),n=setTimeout((function(){clearTimeout(n),e.apply(void 0,r)}),t)}}e.exports?e.exports=f:window.EasyChatWidget=f;var w={"bottom-right":{toggle:{bottom:"20px",right:"20px",left:"auto",transform:"none"},window:{bottom:"100px",right:"20px",left:"auto",transform:"none"}},"bottom-left":{toggle:{bottom:"20px",left:"20px",right:"auto",transform:"none"},window:{bottom:"100px",left:"20px",right:"auto",transform:"none"}},"bottom-center":{toggle:{bottom:"20px",left:"50%",right:"auto",transform:"translateX(-50%)"},window:{bottom:"100px",left:"50%",right:"auto",transform:"translateX(-50%)"}}},x=document.createElement("style");x.textContent="\n    @media screen and (max-width: 480px) {\n        .chat-input {\n            position: relative;\n            z-index: 1000;\n        }\n        \n        .chat-input input {\n            font-size: 16px !important;\n            -webkit-appearance: none;\n            border-radius: 8px;\n            padding: 12px;\n            margin: 0;\n            width: 100%;\n            box-sizing: border-box;\n            border: 1px solid rgba(0,0,0,0.1);\n            background-color: #ffffff !important;\n            opacity: 1 !important;\n            pointer-events: auto !important;\n        }\n\n        .chat-input input::placeholder {\n            user-select: none;\n            -webkit-user-select: none;\n            pointer-events: none; /* Prevent the placeholder from blocking input focus */\n        }\n        \n        .chat-window.active .chat-input {\n            position: sticky;\n            bottom: 0;\n            background-color: #ffffff;\n            padding: 10px;\n            margin: 0;\n            z-index: 1000;\n        }\n    }\n",document.head.appendChild(x)}},t={},function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}(954);var e,t}));