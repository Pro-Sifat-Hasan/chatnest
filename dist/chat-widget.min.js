/*! For license information please see chat-widget.min.js.LICENSE.txt */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.EasyChatWidget=n():e.EasyChatWidget=n()}(this,(()=>{return e={954:e=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function t(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n,t){return(n=m(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,o,a,s=[],c=!0,l=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=o.call(t)).done)&&(s.push(r.value),s.length!==n);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,n)||s(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,n){if(e){if("string"==typeof e)return c(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function l(){"use strict";l=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,o=Object.defineProperty||function(e,n,t){e[n]=t.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function h(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{h({},"")}catch(e){h=function(e,n,t){return e[n]=t}}function u(e,n,t,r){var i=n&&n.prototype instanceof y?n:y,a=Object.create(i.prototype),s=new F(r||[]);return o(a,"_invoke",{value:H(e,t,s)}),a}function p(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var g="suspendedStart",m="suspendedYield",f="executing",v="completed",b={};function y(){}function w(){}function x(){}var k={};h(k,s,(function(){return this}));var S=Object.getPrototypeOf,E=S&&S(S(A([])));E&&E!==r&&i.call(E,s)&&(k=E);var C=x.prototype=y.prototype=Object.create(k);function M(e){["next","throw","return"].forEach((function(n){h(e,n,(function(e){return this._invoke(n,e)}))}))}function L(e,t){function r(o,a,s,c){var l=p(e[o],e,a);if("throw"!==l.type){var d=l.arg,h=d.value;return h&&"object"==n(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(h).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return a=a?a.then(i,i):i()}})}function H(n,t,r){var i=g;return function(o,a){if(i===f)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===b)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===g)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var l=p(n,t,r);if("normal"===l.type){if(i=r.done?v:m,l.arg===b)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=v,r.method="throw",r.arg=l.arg)}}}function T(n,t){var r=t.method,i=n.iterator[r];if(i===e)return t.delegate=null,"throw"===r&&n.iterator.return&&(t.method="return",t.arg=e,T(n,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var o=p(i,n.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,b;var a=o.arg;return a?a.done?(t[n.resultName]=a.value,t.next=n.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function z(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function q(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(z,this),this.reset(!0)}function A(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=x,o(C,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=h(x,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,d,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},M(L.prototype),h(L.prototype,c,(function(){return this})),t.AsyncIterator=L,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new L(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(C),h(C,d,"Generator"),h(C,s,(function(){return this})),h(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var r in n)t.push(r);return t.reverse(),function e(){for(;t.length;){var r=t.pop();if(r in n)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,F.prototype={constructor:F,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(q),!n)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var t=this;function r(r,i){return s.type="throw",s.arg=n,t.next=r,i&&(t.method="next",t.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=n,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),b},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),q(t),b}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var i=r.arg;q(t)}return i}}throw Error("illegal catch attempt")},delegateYield:function(n,t,r){return this.delegate={iterator:A(n),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function d(e,n,t,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void t(e)}s.done?n(c):Promise.resolve(c).then(r,i)}function h(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){d(o,r,i,a,s,"next",e)}function s(e){d(o,r,i,a,s,"throw",e)}a(void 0)}))}}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function p(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function g(e,n,t){return n&&p(e.prototype,n),t&&p(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var f=function(){return g((function e(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,e),this.isWaitingForResponse=!1,this.initConfig(t),this.userManager=new v(this.config),this.storageManager=new b(this.userManager,this.config),this.ensureDependencies().then((function(){n.initializeWidget(),n.setupEventListeners(),n.storageManager.setWidget(n),n.loadChatHistory(),n.setupEraseButton()})),this.activeForm=null,w[this.config.position]||(console.warn('Invalid position "'.concat(this.config.position,'". Falling back to bottom-right.')),this.config.position="bottom-right")}),[{key:"initConfig",value:function(e){var n,t,r,i,o=function(e,n,t){var r=parseInt(e);return"".concat(Math.min(Math.max(r,n),t),"px")},a=function(e){return e?e.startsWith("//")?"".concat(window.location.protocol).concat(e):e.startsWith("/")?"".concat(window.location.origin).concat(e):e.startsWith("http")?e:"http://".concat(e):"http://localhost:7000/chat"};this.config={botName:e.botName||"Chat Assistant",botImage:e.botImage||'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"%3E%3Cpath fill="%23fff" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"%3E%3C/path%3E%3C/svg%3E',greeting:e.greeting||"Hello! How can I help you today?",placeholder:e.placeholder||"Type your message here...",primaryColor:e.primaryColor||"#0084ff",fontSize:function(e){var n;n="string"==typeof e?parseInt(e.replace("px","")):"number"==typeof e?e:14;var t=Math.min(Math.max(14,n),25);return"".concat(t,"px")}(e.fontSize||14),width:o(e.width||"400px",300,600),height:o(e.height||"600px",400,800),showTimestamp:e.showTimestamp||!1,enableTypingIndicator:!1!==e.enableTypingIndicator,enableMarkdown:!1!==e.enableMarkdown,enableHistory:!1!==e.enableHistory,maxHistoryLength:e.maxHistoryLength||100,enableTypewriter:!1!==e.enableTypewriter,typewriterSpeed:e.typewriterSpeed||{min:30,max:70},chips:e.chips||[],customStyles:e.customStyles||{},onInit:e.onInit||null,onMessage:e.onMessage||null,onError:e.onError||null,apiEndpoint:a(e.apiEndpoint),apiKey:e.apiKey||"",apiHeaders:e.apiHeaders||{"Content-Type":"application/json"},apiRequestFormat:e.apiRequestFormat||{query:"query",userId:"userId",domain:"domain"},apiResponseFormat:e.apiResponseFormat||{response:"response"},apiMethod:e.apiMethod||"POST",apiTimeout:e.apiTimeout||3e4,enableBackendHistory:!1!==e.enableBackendHistory,backendHistoryEndpoint:a(e.backendHistoryEndpoint),deleteEndpoint:a(e.deleteEndpoint)||"".concat(a(e.apiEndpoint).replace(/\/chat$/,""),"/delete-history"),separateSubpageHistory:e.separateSubpageHistory||!1,feedbackEndpoint:a(e.feedbackEndpoint)||"".concat(this.config.apiEndpoint,"/feedback"),hubspot:{enabled:(null===(n=e.hubspot)||void 0===n?void 0:n.enabled)||!1,portalId:(null===(t=e.hubspot)||void 0===t?void 0:t.portalId)||"",formGuid:(null===(r=e.hubspot)||void 0===r?void 0:r.formGuid)||"",triggerKeywords:(null===(i=e.hubspot)||void 0===i?void 0:i.triggerKeywords)||["pricing","demo","contact","quote","help","support"],formShownToUsers:new Set,formSubmittedUsers:new Set},position:e.position||"bottom-right"}}},{key:"updateFontSize",value:function(e){this.config.fontSize=e,document.documentElement.style.setProperty("--chat-message-font-size",e)}},{key:"ensureDependencies",value:(d=h(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.marked||!this.config.enableMarkdown){e.next=3;break}return e.next=3,this.loadScript("https://cdn.jsdelivr.net/npm/marked/marked.min.js");case 3:this.loadStyles();case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"loadScript",value:function(e){return new Promise((function(n,t){var r=document.createElement("script");r.src=e,r.async=!0,r.onload=n,r.onerror=t,document.head.appendChild(r)}))}},{key:"loadStyles",value:function(){var e=document.createElement("style");e.textContent="\n            :root {\n                --chat-primary-color: ".concat(this.config.primaryColor,";\n                --chat-message-font-size: ").concat(this.config.fontSize,";\n                --chat-width: ").concat(this.config.width,";\n                --chat-height: ").concat(this.config.height,";\n                --chat-toggle-size: 60px;\n                --chat-border-radius: 16px;\n                --chat-shadow: 0 5px 40px rgba(0,0,0,0.16);\n            }\n\n            * {\n                margin: 0;\n                padding: 0;\n                box-sizing: border-box;\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            }\n\n            body {\n                background-color: #f5f5f5;\n                min-height: 100vh;\n            }\n\n            /* Main Website Content */\n            .website-content {\n                padding: 2rem;\n                max-width: 1200px;\n                margin: 0 auto;\n            }\n\n            /* Chat Widget Container */\n            .chat-widget {\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                z-index: 2147483647;\n            }\n\n            .chat-widget.left .chat-toggle {\n                left: 20px;\n                right: auto;\n            }\n\n            .chat-widget.left .chat-window {\n                left: 20px;\n                right: auto;\n            }\n\n            /* Chat Toggle Button */\n            .chat-toggle {\n                width: 60px;\n                height: 60px;\n                border-radius: 50%;\n                background: var(--chat-primary-color);\n                box-shadow: 0 2px 12px rgba(0,0,0,0.15);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: transform 0.3s ease;\n            }\n\n            .chat-toggle:hover {\n                transform: scale(1.1);\n            }\n\n            .chat-toggle img {\n                width: 30px;\n                height: 30px;\n            }\n\n            /* Chat Window */\n            .chat-window {\n                position: fixed;\n                bottom: 100px;\n                right: 20px;\n                width: var(--chat-width);\n                height: var(--chat-height);\n                background: white;\n                border-radius: var(--chat-border-radius);\n                box-shadow: var(--chat-shadow);\n                display: none;\n                flex-direction: column;\n                overflow: hidden;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                transform: translateY(20px);\n                opacity: 0;\n                font-size: var(--chat-font-size);\n                min-width: 300px;\n                max-width: 600px;\n                min-height: 400px;\n                max-height: 800px;\n                padding: 0;\n                box-sizing: border-box;\n                overscroll-behavior: contain;\n                -webkit-overflow-scrolling: touch;\n            }\n\n            .chat-window.active {\n                display: flex;\n                transform: translateY(0);\n                opacity: 1;\n                border-radius: var(--chat-border-radius);\n                overflow: hidden;\n            }\n\n            /* Chat Header */\n            .chat-header {\n                background: var(--chat-primary-color);\n                color: white;\n                padding: 1rem;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                width: 100%;\n                box-sizing: border-box;\n                position: relative;\n                margin: 0;\n                border-top-left-radius: inherit;\n                border-top-right-radius: inherit;\n            }\n\n            /* Fix for header background extending to edges */\n            .chat-header::before {\n                content: '';\n                position: absolute;\n                top: 0;\n                left: -1px;\n                right: -1px;\n                bottom: 0;\n                background: var(--chat-primary-color);\n                z-index: -1;\n                border-top-left-radius: inherit;\n                border-top-right-radius: inherit;\n            }\n\n            .chat-header-title {\n                display: flex;\n                align-items: center;\n                gap: 0.5rem;\n                position: relative;\n                z-index: 1;\n            }\n\n            .chat-header-avatar {\n                width: 32px;\n                height: 32px;\n                border-radius: 50%;\n                background: white;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .chat-header-avatar img {\n                width: 33px;\n                height: 33px;\n                border-radius: 50%;\n            }\n\n            .chat-header-actions {\n                display: flex;\n                align-items: center;\n                gap: 0.5rem;\n                position: relative;\n                z-index: 1;\n            }\n\n            .erase-chat, .close-chat {\n                background: none;\n                border: none;\n                color: white;\n                cursor: pointer;\n                padding: 0.5rem;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .erase-chat img, .close-chat img {\n                width: 20px;\n                height: 20px;\n            }\n\n            /* Chat Messages */\n            .chat-messages {\n                flex: 1;\n                overflow-y: auto;\n                padding: 1rem;\n                display: flex;\n                flex-direction: column;\n                gap: 1rem;\n                overscroll-behavior: contain;\n                -webkit-overflow-scrolling: touch;\n                scroll-behavior: smooth;\n                scrollbar-width: thin;\n                scrollbar-color: rgba(0, 0, 0, 0.2) transparent;\n            }\n\n            .chat-messages::-webkit-scrollbar {\n                width: 6px;\n            }\n\n            .chat-messages::-webkit-scrollbar-track {\n                background: transparent;\n            }\n\n            .chat-messages::-webkit-scrollbar-thumb {\n                background-color: rgba(0, 0, 0, 0.2);\n                border-radius: 3px;\n            }\n\n            /* Prevent iOS rubber-band effect */\n            @supports (-webkit-touch-callout: none) {\n                .chat-window {\n                    height: -webkit-fill-available;\n                }\n                \n                .chat-messages {\n                    height: -webkit-fill-available;\n                }\n            }\n\n            .message {\n                max-width: 80%;\n                padding: 0.8rem 1rem;\n                border-radius: 1rem;\n                margin: 0.25rem 0;\n                font-size: calc(var(--chat-font-size) * 0.8);\n                transition: max-width 0.3s ease, padding 0.3s ease;\n            }\n\n            .message-row {\n                display: flex;\n                align-items: flex-start;\n                gap: 0.5rem;\n            }\n\n            /* Bot Message Styling */\n            .bot-message {\n                max-width: 80%;\n                padding: 1rem;\n                background: #f0f2f5;\n                border-radius: 1rem;\n                border-top-left-radius: 0;\n                font-size: 14px;\n                line-height: 1.5;\n                color: #000000;\n            }\n\n            .bot-message img {\n                max-width: 100%;\n                height: auto;\n                border-radius: 8px;\n                margin: 8px 0;\n                transition: min-height 0.3s ease;\n            }\n\n            .bot-message img[src=\"\"] {\n                display: none;\n            }\n\n            .bot-message a {\n                color: #0084ff;\n                text-decoration: none;\n            }\n\n            .bot-message a:hover {\n                text-decoration: underline;\n            }\n\n            /* User Message */\n            .user-message {\n                margin-left: auto;\n                background: var(--chat-primary-color);\n                color: white;\n                border-top-right-radius: 0;\n                text-align: left;\n            }\n\n            /* Markdown Content Styles */\n            .bot-message h1, .bot-message h2, .bot-message h3 {\n                margin: 16px 0 8px 0;\n            }\n\n            .bot-message p {\n                margin: 8px 0;\n            }\n\n            .bot-message ul, .bot-message ol {\n                margin: 8px 0;\n                padding-left: 20px;\n            }\n\n            .bot-message code {\n                background: rgba(0, 0, 0, 0.05);\n                padding: 2px 4px;\n                border-radius: 4px;\n                font-family: monospace;\n            }\n\n            .bot-message pre {\n                background: rgba(0, 0, 0, 0.05);\n                padding: 12px;\n                border-radius: 4px;\n                overflow-x: auto;\n            }\n\n            .bot-message blockquote {\n                border-left: 4px solid #0084ff;\n                margin: 8px 0;\n                padding-left: 12px;\n                color: #666;\n            }\n\n            /* Chat Input Container */\n            .chat-input-container {\n                padding: 1rem;\n                border-top: 1px solid #e4e6eb;\n            }\n\n            /* Suggestion Chips */\n            .suggestion-chips {\n                padding: 0.5rem;\n                display: flex;\n                gap: 0.5rem;\n                overflow-x: auto;\n                white-space: nowrap;\n                -webkit-overflow-scrolling: touch;\n                scroll-behavior: smooth;\n                scrollbar-width: auto;\n                scrollbar-color: #0084ff #f0f2f5;\n            }\n\n            .suggestion-chips::-webkit-scrollbar {\n                height: 6px;\n            }\n\n            .suggestion-chips::-webkit-scrollbar-track {\n                background: #f0f2f5;\n                border-radius: 3px;\n            }\n\n            .suggestion-chips::-webkit-scrollbar-thumb {\n                background: #0084ff;\n                border-radius: 3px;\n            }\n\n            .chip {\n                background: #e4e6eb;\n                padding: 0.5rem 1rem;\n                border-radius: 16px;\n                white-space: nowrap;\n                cursor: pointer;\n                transition: background 0.2s;\n            }\n\n            .chip:hover {\n                background: #d8dadf;\n            }\n\n            /* Chat Input */\n            .chat-input {\n                display: flex;\n                gap: 0.5rem;\n                margin-top: 12px;\n            }\n\n            .chat-input input {\n                flex: 1;\n                padding: 0.8rem 1rem;\n                border: 1px solid #e4e6eb;\n                border-radius: 20px;\n                outline: none;\n                font-size: 14px;\n            }\n\n            .chat-input input:focus {\n                border-color: #0084ff;\n            }\n\n            .send-button {\n                background: var(--chat-primary-color);\n                color: white;\n                border: none;\n                border-radius: 50%;\n                width: 40px;\n                height: 40px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: background 0.2s;\n                margin-top: 3px;\n            }\n\n            .send-button:hover {\n                background: var(--chat-primary-color);\n                opacity: 0.9;\n            }\n\n            .send-button img {\n                width: 20px;\n                height: 20px;\n            }\n\n            /* Loading Animation */\n            .typing-indicator {\n                display: none;\n                padding: 0.5rem 1rem;\n                background: #f0f2f5;\n                border-radius: 1rem;\n                align-self: flex-start;\n                margin: 0.5rem 0;\n            }\n\n            .typing-indicator span {\n                width: 8px;\n                height: 8px;\n                background: #90949c;\n                display: inline-block;\n                border-radius: 50%;\n                margin: 0 2px;\n                animation: bounce 1.4s infinite ease-in-out;\n            }\n\n            .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }\n            .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }\n\n            @keyframes bounce {\n                0%, 80%, 100% { transform: scale(0); }\n                40% { transform: scale(1); }\n            }\n\n            /* Output Styles */\n            #output {\n                white-space: pre-wrap;\n                font-family: Arial, sans-serif;\n                line-height: 1.5;\n            }\n\n            #output img {\n                max-width: 100%;\n                height: auto;\n            }\n\n            #output code {\n                background-color: #f4f4f4;\n                padding: 2px 4px;\n                border-radius: 3px;\n            }\n\n            /* Dark Theme */\n            .chat-widget.dark {\n                --chat-bg-color: #1a1a1a;\n                --chat-text-color: #ffffff;\n                --chat-message-bg: #2d2d2d;\n                --chat-bot-message-bg: #383838;\n                --chat-input-bg: #2d2d2d;\n                --chat-input-border: #404040;\n            }\n\n            .chat-widget.dark .chat-window {\n                background: var(--chat-bg-color);\n                color: var(--chat-text-color);\n            }\n\n            .chat-widget.dark .message {\n                background: var(--chat-message-bg);\n                color: var(--chat-text-color);\n            }\n\n            .chat-widget.dark .bot-message {\n                background: #2d2d2d;\n                color: #ffffff;\n            }\n\n            .chat-widget.dark .chat-input input {\n                background: var(--chat-input-bg);\n                color: var(--chat-text-color);\n                border-color: var(--chat-input-border);\n            }\n\n            /* Initial greeting message style */\n            .greeting-message {\n                background: #e3f2fd !important;\n                border-left: 3px solid var(--chat-primary-color);\n                color: #000000 !important;\n            }\n\n            /* Responsive Design */\n            /* Mobile Portrait */\n            @media screen and (max-width: 480px) {\n                :root {\n                --chat-toggle-size: 50px;\n                }\n            \n                .chat-window {\n                bottom: 0;\n                right: 0;\n                left: 0;\n                width: 100%;\n                height: 100vh;\n                border-radius: 0;\n                max-height: calc(100vh - env(safe-area-inset-bottom));\n                }\n            \n                .chat-toggle {\n                bottom: 10px;\n                right: 10px;\n                }\n            \n                .chat-header {\n                padding: 0.8rem;\n                }\n            \n                .chat-messages {\n                padding: 0.8rem;\n                }\n            \n                .chat-input-container {\n                padding: 0.8rem;\n                padding-bottom: max(0.8rem, env(safe-area-inset-bottom));\n                }\n            \n                .message {\n                max-width: 85%;\n                padding: 0.7rem;\n                }\n            \n                .suggestion-chips {\n                padding: 0.5rem 0;\n                }\n            \n                .chip {\n                padding: 0.4rem 0.8rem;\n                font-size: 0.9rem;\n                }\n            }\n            \n            /* Mobile Landscape */\n            @media screen and (max-height: 500px) and (orientation: landscape) {\n                .chat-window {\n                height: 100vh;\n                max-height: calc(100vh - 20px);\n                }\n            \n                .chat-messages {\n                flex: 1;\n                max-height: calc(100vh - 180px);\n                }\n            \n                .suggestion-chips {\n                padding: 0.3rem 0;\n                }\n            \n                .chip {\n                padding: 0.3rem 0.6rem;\n                }\n            \n                .chat-input-container {\n                padding: 0.5rem;\n                }\n            }\n            \n            /* Tablet Portrait */\n            @media screen and (min-width: 481px) and (max-width: 768px) {\n                .chat-window {\n                width: 380px;\n                height: 520px;\n                bottom: 80px;\n                right: 10px;\n                }\n            \n                .chat-toggle {\n                bottom: 15px;\n                right: 15px;\n                }\n            }\n            \n            /* Tablet Landscape */\n            @media screen and (min-width: 769px) and (max-width: 1024px) {\n                .chat-window {\n                width: 420px;\n                height: 580px;\n                }\n            }\n            \n            /* Desktop */\n            @media screen and (min-width: 1025px) and (max-width: 1919px) {\n                .chat-window {\n                width: 425px;\n                height: 600px;\n                }\n            }\n            \n            /* Large Desktop (1920px and above) */\n            @media screen and (min-width: 1920px) {\n                .chat-window {\n                width: 500px;\n                height: 700px;\n                }\n                \n                .chat-messages {\n                font-size: 1.1em;\n                }\n                \n                .chat-input input {\n                font-size: 1em;\n                padding: 1rem 1.2rem;\n                }\n                \n                .send-button {\n                width: 48px;\n                height: 48px;\n                }\n                \n                .chat-header {\n                padding: 1.2rem;\n                }\n            }\n            \n            /* 4K Displays */\n            @media screen and (min-width: 2560px) {\n                .chat-window {\n                width: 600px;\n                height: 800px;\n                }\n                \n                .chat-messages {\n                font-size: 1.2em;\n                }\n                \n                .chat-input input {\n                font-size: 1.1em;\n                padding: 1.2rem 1.4rem;\n                }\n                \n                .send-button {\n                width: 52px;\n                height: 52px;\n                }\n                \n                .chat-header {\n                padding: 1.4rem;\n                }\n            }\n\n            @media screen and (min-width: 1930px) {\n                .chat-window {\n                width: 450px;\n                height: 600px;\n                }\n            }\n\n            .hubspot-form-container {\n                transition: opacity 0.3s ease, transform 0.3s ease;\n            }\n\n            .chat-input-container.disabled {\n                opacity: 0.7;\n                pointer-events: none;\n            }\n\n            .chat-input-container.disabled::after {\n                content: 'Please complete the form above';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: var(--chat-primary-color);\n                opacity: 0.8;\n            }\n\n            .hubspot-form-success {\n                transition: opacity 0.3s ease, transform 0.3s ease;\n                padding: 20px;\n                background: #d4edda;\n                border-radius: 8px;\n                text-align: center;\n            }\n\n            .chip {\n                transition: opacity 0.3s ease, pointer-events 0.3s ease;\n            }\n\n            .chat-input input,\n            .send-button {\n                transition: opacity 0.3s ease, background-color 0.3s ease;\n            }\n\n            /* Safe Area Insets for Modern Mobile Devices */\n            @supports (padding: max(0px)) {\n                .chat-window {\n                    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n                    // padding-right: max(1rem, env(safe-area-inset-right));\n                    // padding-left: max(1rem, env(safe-area-inset-left));\n                }\n\n                .chat-input-container {\n                    padding-bottom: max(1rem, env(safe-area-inset-bottom));\n                }\n            }\n\n            /* High Contrast Mode */\n            @media (prefers-contrast: high) {\n                .chat-widget {\n                    --chat-primary-color: #000000;\n                    --chat-secondary-color: #ffffff;\n                }\n\n                .message {\n                    border: 2px solid #000000;\n                }\n            }\n\n            /* Reduced Motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chat-toggle,\n                .chat-window {\n                    transition: none;\n                }\n            }\n\n            /* Print Styles */\n            @media print {\n                .chat-widget {\n                    display: none;\n                }\n            }\n            ").concat(this.config.customStyles,"\n\n            /* Image Preview Styles */\n            .image-container {\n                position: relative;\n                margin: 8px 0;\n                border-radius: 8px;\n            }\n\n            .image-container img {\n                max-width: 100%;\n                height: auto;\n                display: block;\n                border-radius: 8px;\n            }\n\n            .image-container svg {\n                opacity: 0.7;\n            }\n\n            .fullscreen-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0, 0, 0, 0.9);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 2147483647;\n                padding: 20px;\n            }\n\n            .preview-container {\n                position: relative;\n                max-width: 90vw;\n                max-height: 90vh;\n            }\n\n            .preview-image {\n                max-width: 100%;\n                max-height: 90vh;\n                object-fit: contain;\n            }\n\n            .close-preview {\n                position: absolute;\n                top: -40px;\n                right: -40px;\n                background: none;\n                border: none;\n                color: white;\n                font-size: 32px;\n                cursor: pointer;\n                padding: 10px;\n                line-height: 1;\n            }\n\n            .close-preview:hover {\n                color: #ddd;\n            }\n\n            @media (max-width: 768px) {\n                .close-preview {\n                    top: -40px;\n                    right: 0;\n                }\n            }\n\n            /* Amazon Product Link Styles */\n            .amazon-product-link {\n                margin: 10px 0;\n            }\n\n            .amazon-button {\n                display: inline-flex;\n                align-items: center;\n                gap: 5px;\n                padding: 5px 10px;\n                border: 1px solid #007bff;\n                border-radius: 5px;\n                color: #007bff;\n                text-decoration: none;\n                transition: background-color 0.3s ease;\n            }\n\n            .amazon-button:hover {\n                background-color: #007bff;\n                color: #ffffff;\n            }\n\n            .amazon-icon {\n                width: 20px;\n                height: 20px;\n            }\n\n            .chat-input input.waiting {\n                background-color: #ffffff !important; /* Keep background white when waiting */\n                cursor: text !important; /* Keep text cursor */\n            }\n\n            .chat-input input:disabled {\n                background-color: #f5f5f5;\n                cursor: not-allowed;\n            }\n\n            .send-button:disabled {\n                cursor: not-allowed;\n                opacity: 0.5;\n            }\n\n            .chat-input-container.waiting::after {\n                content: 'Processing...';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: var(--chat-primary-color);\n                opacity: 0.7;\n            }\n\n            /* Keep default font size for chat input */\n            .chat-input input {\n                font-size: 14px; /* Fixed size */\n                padding: 0.8rem 1rem;\n                border: 1px solid #e4e6eb;\n                border-radius: 20px;\n                outline: none;\n            }\n\n            /* Apply custom font size only to messages */\n            .message.user-message,\n            .message.bot-message {\n                font-size: var(--chat-message-font-size);\n            }\n\n            /* Keep all other elements at their default size */\n            .chat-header,\n            .chat-header-title h2,\n            .chat-input-container,\n            .suggestion-chips,\n            .chip,\n            .send-button,\n            .close-chat,\n            .erase-chat {\n                font-size: 14px; /* Fixed size */\n            }\n\n            /* Ensure markdown content inside bot messages uses the custom font size */\n            .bot-message p,\n            .bot-message ul,\n            .bot-message ol,\n            .bot-message li {\n                font-size: var(--chat-message-font-size);\n            }\n\n            /* Keep code blocks slightly smaller than message text */\n            .bot-message code {\n                font-size: calc(var(--chat-message-font-size) * 0.9);\n            }\n\n            /* Keep headers in markdown proportional to message size */\n            .bot-message h1 { font-size: calc(var(--chat-message-font-size) * 1.5); }\n            .bot-message h2 { font-size: calc(var(--chat-message-font-size) * 1.3); }\n            .bot-message h3 { font-size: calc(var(--chat-message-font-size) * 1.1); }\n\n            .message-actions {\n                display: none;\n                gap: 8px;\n                margin-top: 8px;\n            }\n\n            .bot-message-container:hover .message-actions,\n            .bot-message-container.last .message-actions {\n                display: flex;\n            }\n\n            .message-action-btn {\n                background: none;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 4px 8px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                transition: all 0.2s ease;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                color: white;\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n            }\n\n            .bot-message-container {\n                display: flex;\n                flex-direction: column;\n            }\n\n            /* Message Actions Container */\n            .message-actions {\n                display: none;  /* Hidden by default */\n                gap: 8px;\n                margin-top: 8px;\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n\n            /* Show actions on container hover */\n            .bot-message-container:hover .message-actions {\n                display: flex;\n                opacity: 1;\n            }\n\n            /* Always show actions for last message */\n            .bot-message-container.last .message-actions {\n                display: flex !important;\n                opacity: 1;\n            }\n\n            .message-action-btn {\n                background: #ffffff;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 6px 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                transition: all 0.2s ease;\n                font-size: 12px;\n                color: #666;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n                border-color: #d4d4d4;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                color: white;\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn.active img {\n                filter: brightness(0) invert(1);\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n                opacity: 0.7;\n            }\n\n            .bot-message-container {\n                display: flex;\n                flex-direction: column;\n                position: relative;\n                width: 100%;\n            }\n\n            /* Copied tooltip */\n            .copy-btn.copied::after {\n                content: 'Copied!';\n                position: absolute;\n                top: -25px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 4px 8px;\n                border-radius: 4px;\n                font-size: 12px;\n                pointer-events: none;\n            }\n\n            .message-actions {\n                display: none;\n                gap: 4px;\n                margin-top: 4px;\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n\n            .bot-message-container:hover .message-actions {\n                display: flex;\n                opacity: 1;\n            }\n\n            .bot-message-container.last .message-actions {\n                display: flex !important;\n                opacity: 1;\n            }\n\n            .message-action-btn {\n                background: #ffffff;\n                border: 1px solid #e4e6eb;\n                border-radius: 4px;\n                padding: 4px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n                width: 28px;\n                height: 28px;\n            }\n\n            .message-action-btn:hover {\n                background: #f0f2f5;\n                border-color: #d4d4d4;\n            }\n\n            .message-action-btn img {\n                width: 16px;\n                height: 16px;\n                opacity: 0.7;\n            }\n\n            .message-action-btn.active {\n                background: var(--chat-primary-color);\n                border-color: var(--chat-primary-color);\n            }\n\n            .message-action-btn.active img {\n                opacity: 1;\n                filter: brightness(0) invert(1);\n            }\n\n            /* Copied tooltip */\n            .copy-btn.copied::after {\n                content: 'Copied!';\n                position: absolute;\n                top: -25px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 4px 8px;\n                border-radius: 4px;\n                font-size: 12px;\n                pointer-events: none;\n            }\n\n            /* Add powered by link styles */\n            .powered-by {\n                text-align: center;\n                padding: 0px;\n                font-size: 12px;\n                color: #666;\n                // border-top: 1px solid #e4e6eb;\n            }\n\n            .powered-by a {\n                color: var(--chat-primary-color);\n                text-decoration: none;\n                font-weight: 500;\n            }\n\n            .powered-by a:hover {\n                text-decoration: underline;\n            }\n\n            /* Base chat widget positioning */\n            .chat-widget {\n                position: fixed;\n                z-index: 2147483647;\n            }\n\n            /* Position-specific styles for toggle and window */\n            .chat-widget.bottom-right .chat-toggle {\n                bottom: 20px;\n                right: 20px;\n            }\n            .chat-widget.bottom-right .chat-window {\n                bottom: 100px;\n                right: 20px;\n            }\n\n            .chat-widget.bottom-left .chat-toggle {\n                bottom: 20px;\n                left: 20px;\n            }\n            .chat-widget.bottom-left .chat-window {\n                bottom: 100px;\n                left: 20px;\n            }\n\n            .chat-widget.bottom-center .chat-toggle {\n                bottom: 20px;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n            .chat-widget.bottom-center .chat-window {\n                bottom: 100px;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n\n            .chat-widget.top .chat-toggle {\n                top: 20px;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n            .chat-widget.top .chat-window {\n                top: 100px;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n\n            .chat-widget.left .chat-toggle {\n                left: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n            }\n            .chat-widget.left .chat-window {\n                left: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n            }\n\n            .chat-widget.right .chat-toggle {\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n            }\n            .chat-widget.right .chat-window {\n                right: 20px;\n                top: 50%;\n                transform: translateY(-50%);\n            }\n\n            .chat-widget.top-right .chat-toggle {\n                top: 20px;\n                right: 20px;\n            }\n            .chat-widget.top-right .chat-window {\n                top: 100px;\n                right: 20px;\n            }\n\n            .chat-widget.top-left .chat-toggle {\n                top: 20px;\n                left: 20px;\n            }\n            .chat-widget.top-left .chat-window {\n                top: 100px;\n                left: 20px;\n            }\n\n            /* Mobile adjustments */\n            @media screen and (max-width: 480px) {\n                .chat-widget .chat-window {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    width: 100% !important;\n                    height: 100% !important;\n                    transform: none !important;\n                }\n            }\n        ");var n=document.getElementById("chat-widget-styles");n&&n.remove(),document.head.appendChild(e)}},{key:"createWidget",value:function(){var e=document.createElement("div");e.className="chat-widget ".concat(this.config.theme," ").concat(this.config.position);var n=w[this.config.position],t=Object.entries(n.toggle).map((function(e){var n=a(e,2),t=n[0],r=n[1];return"".concat(t,": ").concat(r,";")})).join(" "),r='\n            <div class="chat-toggle" style="position: fixed; '.concat(t,"\">\n                <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z'/%3E%3C/svg%3E\" alt=\"Chat\">\n            </div>\n        "),i=Object.entries(n.window).map((function(e){var n=a(e,2),t=n[0],r=n[1];return"".concat(t,": ").concat(r,";")})).join(" "),o='\n            <div class="chat-window" style="position: fixed; '.concat(i,'">\n                <div class="chat-header">\n                    <div class="chat-header-title">\n                        <div class="chat-header-avatar">\n                            <img src="').concat(this.config.botImage,'" alt="').concat(this.config.botName,'" class="bot-avatar">\n                        </div>\n                        <h2 style="font-weight: bold; font-size: 20px;">').concat(this.config.botName,'</h2>\n                    </div>\n                    <div class="chat-header-actions">\n                        <button class="erase-chat">\n                            <img src="https://i.ibb.co.com/9YP3swm/erase.png" alt="Erase" title="Clear chat history">\n                        </button>\n                        <button class="close-chat">\n                            <img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\'/%3E%3C/svg%3E" alt="Close" title="Close chat">\n                        </button>\n                    </div>\n                </div>\n\n                <div class="chat-messages">\n                    <div class="message-row" id="greeting-row">\n                        <div class="message bot-message greeting-message">\n                            ').concat(this.config.greeting,'\n                        </div>\n                    </div>\n                    <div class="typing-indicator">\n                        <span>●</span><span>●</span><span>●</span>\n                    </div>\n                </div>\n\n                ').concat(this.config.chips.length>0?'\n                    <div class="suggestion-chips">\n                        '.concat(this.config.chips.map((function(e){return'\n                            <div class="chip">'.concat(e,"</div>\n                        ")})).join(""),"\n                    </div>\n                "):"",'\n\n                <div class="chat-input-container">\n                    <div class="chat-input">\n                        <input type="text" placeholder="').concat(this.config.placeholder,'" aria-label="Chat input">\n                        <button class="send-button">\n                            <img src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'white\'%3E%3Cpath d=\'M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\'/%3E%3C/svg%3E" alt="Send">\n                        </button>\n                    </div>\n                </div>\n                \x3c!--<div class="powered-by">\n                   Powered by <a href="https://neurobrains.co" target="_blank">NeuroBrain</a>\n                </div> --\x3e\n            </div>\n        ');e.innerHTML=r+o,document.body.appendChild(e),this.widget=e}},{key:"initializeWidget",value:function(){this.createWidget(),this.setupSuggestionChips(),this.setupResponsiveHandling(),this.setupScrollContainment(),console.log("Chat widget initialized.")}},{key:"setupEventListeners",value:function(){var e=this,n=this.widget.querySelector(".chat-toggle"),t=this.widget.querySelector(".chat-window"),r=this.widget.querySelector(".close-chat"),i=(this.widget.querySelector(".erase-chat"),this.widget.querySelector(".chat-messages")),o=this.widget.querySelector(".chat-input input"),a=this.widget.querySelector(".send-button"),s=(this.widget.querySelector(".typing-indicator"),function(e){n.innerHTML=e?"<img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z'/%3E%3C/svg%3E\" alt=\"Close\">":"<img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z'/%3E%3C/svg%3E\" alt=\"Chat\">"});n.addEventListener("click",(function(){t.classList.contains("active")?(t.classList.remove("active"),s(!1),setTimeout((function(){t.style.display="none"}),300)):(t.style.display="flex",s(!0),requestAnimationFrame((function(){t.classList.add("active"),o.focus()})))})),r.addEventListener("click",(function(){t.classList.remove("active"),s(!1),setTimeout((function(){t.style.display="none"}),300)}));var c=function(){var n=o.value.trim();!n||e.isWaitingForResponse||e.isTypewriterActive||e.sendMessage(n)};if(a.addEventListener("click",c),o.addEventListener("keypress",(function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())})),o.addEventListener("input",(function(){var n=!o.value.trim(),t=e.isWaitingForResponse||e.isTypewriterActive;a.disabled=n||t,a.style.opacity=a.disabled?"0.5":"1"})),document.addEventListener("click",(function(e){t.contains(e.target)||n.contains(e.target)||t.classList.contains("active")&&(t.classList.remove("active"),s(!1),setTimeout((function(){t.style.display="none"}),300))})),t.addEventListener("click",(function(e){e.stopPropagation()})),"ontouchstart"in window){var l=0,d=0;i.addEventListener("touchstart",(function(e){l=e.touches[0].clientY})),i.addEventListener("touchmove",(function(e){d=e.touches[0].clientY;var n=i.scrollTop,t=i.scrollHeight,r=i.clientHeight;0===n&&d>l&&e.preventDefault(),n+r>=t&&d<l&&e.preventDefault()}),{passive:!1})}window.addEventListener("resize",(function(){window.innerWidth<=480?t.style.height="".concat(window.innerHeight,"px"):t.style.height=""})),window.addEventListener("orientationchange",(function(){setTimeout((function(){window.innerWidth<=480&&(t.style.height="".concat(window.innerHeight,"px")),i.scrollTop=i.scrollHeight}),100)}));var h=document.createElement("style");h.textContent="\n            .chat-input input:disabled {\n                background-color: #f5f5f5;\n                cursor: not-allowed;\n            }\n            \n            .send-button:disabled {\n                cursor: not-allowed;\n            }\n            \n            .chat-input-container.waiting {\n                position: relative;\n            }\n            \n            .chat-input-container.waiting::after {\n                content: 'Waiting for response...';\n                position: absolute;\n                top: -20px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 12px;\n                color: #666;\n            }\n        ",document.head.appendChild(h)}},{key:"setupSuggestionChips",value:function(){var e=this;this.widget.querySelectorAll(".chip").forEach((function(n){n.addEventListener("click",(function(){if(!e.isWaitingForResponse){var t=n.textContent;e.sendMessage(t),e.disableChips()}}))}));var n=document.createElement("style");n.textContent="\n            .chip {\n                transition: opacity 0.3s ease, background-color 0.3s ease;\n            }\n            \n            .chip.disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n                pointer-events: none;\n                background-color: #e0e0e0;\n            }\n        ",document.head.appendChild(n)}},{key:"disableChips",value:function(){this.widget.querySelectorAll(".chip").forEach((function(e){e.classList.add("disabled")}))}},{key:"enableChips",value:function(){this.widget.querySelectorAll(".chip").forEach((function(e){e.classList.remove("disabled")}))}},{key:"typeWriter",value:function(e,n,t){this.isTypewriterActive=!0,this.disableSendingFunctionality();var r=!1,i=0,o=this.widget.querySelector(".chat-messages"),a=function(){o.scrollTop<i&&(r=!0),i=o.scrollTop};o.addEventListener("scroll",a),e.innerHTML="";var s="",c=function(e){for(var n=[],t="",r=!1,i=!1,o=0;o<e.length;o++){var a=e[o];"<"!==a||i?">"===a&&r?(t+=a,n.push(t),t="",r=!1):r?t+=a:"*"===a&&"*"===e[o+1]?(t&&n.push(t),n.push("**"),o++,t=""):"["===a||"!"===a&&"["===e[o+1]?(t&&n.push(t),t=a,i=!0):i&&"]"===a&&"("===e[o+1]?(t+=a+"(",o++):i&&")"===a?(t+=a,n.push(t),t="",i=!1):" "===a||"\n"===a?(t&&n.push(t),n.push(a),t=""):(t+=a,i||r||o!==e.length-1&&" "!==e[o+1]&&"\n"!==e[o+1]||(n.push(t),t="")):(t&&n.push(t),t=a,r=!0)}return t&&n.push(t),n}(n),l=0;function d(){if(l>=c.length)return o.removeEventListener("scroll",a),this.isTypewriterActive=!1,this.enableSendingFunctionality(),void(t&&t());var n,i=c[l],h=i.startsWith("<")&&i.endsWith(">"),u=i.startsWith("**")||i.startsWith("[")||i.startsWith("![");s+=i,e.innerHTML=s,requestAnimationFrame((function(){var e,n,t,i;r||o.scrollHeight-o.scrollTop-o.clientHeight<100&&(o.scrollTop=o.scrollHeight),null===(e=event)||void 0===e||null===(n=e.preventDefault)||void 0===n||n.call(e),null===(t=event)||void 0===t||null===(i=t.stopPropagation)||void 0===i||i.call(t)})),l++,n=h||u?0:" "===i?20:"\n"===i?50:40*Math.random()+30,setTimeout(d,n)}(d=d.bind(this))()}},{key:"disableSendingFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),n=this.widget.querySelector(".send-button");e.readOnly=!1,n.disabled=!0,n.style.opacity="0.5",this.disableChips(),e.classList.add("waiting")}},{key:"enableSendingFunctionality",value:function(){if(!this.isWaitingForResponse&&!this.isTypewriterActive){var e=this.widget.querySelector(".chat-input input"),n=this.widget.querySelector(".send-button");e.readOnly=!1,n.disabled=!1,n.style.opacity="1",this.enableChips(),e.classList.remove("waiting")}}},{key:"addMessage",value:function(e,n){var t=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.widget.querySelector(".chat-messages"),o=this.widget.querySelector(".typing-indicator"),a=document.createElement("div");if(a.className="message-row","bot"===n){var s=document.createElement("div");s.className="bot-message-container";var c=document.createElement("div");c.className="message ".concat(n,"-message");var l=document.createElement("div");l.className="message-actions",l.style.display="none",l.innerHTML="\n                <button class=\"message-action-btn copy-btn\" title=\"Copy to clipboard\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z'/%3E%3C/svg%3E\" alt=\"Copy\">\n                </button>\n                <button class=\"message-action-btn like-btn\" title=\"Helpful\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z'/%3E%3C/svg%3E\" alt=\"Like\">\n                </button>\n                <button class=\"message-action-btn dislike-btn\" title=\"Not helpful\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z'/%3E%3C/svg%3E\" alt=\"Dislike\">\n                </button>\n                <button class=\"message-action-btn regenerate-btn\" title=\"Regenerate response\">\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z'/%3E%3C/svg%3E\" alt=\"Regenerate\">\n                </button>\n            ",this.config.enableMarkdown&&"bot"===n?r&&this.config.enableTypewriter?(c.innerHTML="",this.typeWriter(c,marked.parse(e),(function(){l.style.display="flex",t.setupMessageLinks(c),t.scrollToTypingIndicator(),t.updateLastBotMessage(),t.checkForTriggerWords(e)&&setTimeout((function(){t.showHubSpotForm()}),500)}))):(c.innerHTML=marked.parse(e),l.style.display="flex",this.setupMessageLinks(c),this.checkForTriggerWords(e)&&this.showHubSpotForm()):(c.textContent=e,l.style.display="flex"),s.appendChild(c),s.appendChild(l),a.appendChild(s),this.setupMessageActions(s,e),this.checkForTriggerWords(e)&&(r&&this.config.enableTypewriter?this.typeWriter(c,marked.parse(e),(function(){t.showHubSpotForm()})):this.showHubSpotForm())}else{var d=document.createElement("div");d.className="message ".concat(n,"-message"),d.textContent=e,a.appendChild(d)}i.insertBefore(a,o),this.updateLastBotMessage()}},{key:"setupMessageLinks",value:function(e){e.querySelectorAll("a").forEach((function(e){e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")})),e.querySelectorAll("img").forEach((function(e){var n=document.createElement("div");n.className="image-container",e.parentNode.insertBefore(n,e),n.appendChild(e),e.addEventListener("error",(function(){n.innerHTML='\n                <svg width="50" height="50" viewBox="0 0 24 24" fill="#999">\n                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>\n                </svg>',n.style.padding="20px",n.style.textAlign="center"}))}))}},{key:"sendMessage",value:(c=h(l().mark((function e(n){var t,r,i,o,a,s,c=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>1&&void 0!==c[1]&&c[1],!this.isWaitingForResponse&&!this.isTypewriterActive){e.next=3;break}return e.abrupt("return");case 3:return r=this.widget.querySelector(".typing-indicator"),i=this.widget.querySelector(".chat-input input"),e.prev=5,this.isWaitingForResponse=!0,this.disableSendingFunctionality(),r.style.display="block",t||(this.addMessage(n,"user"),this.storageManager.saveMessage(n,"user")),this.scrollToTypingIndicator(),i.value="",i.focus(),o=this.formatRequestData(n),e.next=16,this.makeApiCall(o);case 16:a=e.sent,s=this.config.transformResponse?this.config.transformResponse(a):a[this.config.apiResponseFormat.response],this.addMessage(s,"bot",!0),this.storageManager.saveMessage(s,"bot",t),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),console.error("API Error:",e.t0),this.addMessage("Sorry, there was an error processing your request.","bot",!1);case 26:return e.prev=26,this.isWaitingForResponse=!1,this.enableSendingFunctionality(),r.style.display="none",i.focus(),e.finish(26);case 32:case"end":return e.stop()}}),e,this,[[5,22,26,32]])}))),function(e){return c.apply(this,arguments)})},{key:"formatRequestData",value:function(e){var n=o(o(o({},this.config.apiRequestFormat.query,e),this.config.apiRequestFormat.userId,this.userManager.currentUser),this.config.apiRequestFormat.domain,this.userManager.domain);return this.config.transformRequest?this.config.transformRequest(n):n}},{key:"makeApiCall",value:(s=h(l().mark((function e(n){var t,r,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i({},this.config.apiHeaders),this.config.apiKey&&(t.Authorization="Bearer ".concat(this.config.apiKey)),r=new AbortController,o=setTimeout((function(){return r.abort()}),this.config.apiTimeout),e.prev=4,e.next=7,fetch(this.config.apiEndpoint,{method:this.config.apiMethod,headers:t,body:JSON.stringify(n),signal:r.signal});case 7:if((a=e.sent).ok){e.next=10;break}throw new Error("HTTP error! status: ".concat(a.status));case 10:return e.next=12,a.json();case 12:return s=e.sent,e.abrupt("return",s);case 14:return e.prev=14,clearTimeout(o),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[4,,14,17]])}))),function(e){return s.apply(this,arguments)})},{key:"processApiResponse",value:function(e,n){n.style.display="none";var t=this.config.transformResponse?this.config.transformResponse(e):e[this.config.apiResponseFormat.response];this.widget.querySelector(".chat-window").classList.add("active"),this.addMessage(t,"bot",!0),this.storageManager.saveMessage(t,"bot")}},{key:"handleApiError",value:function(e,n){console.error("API Error:",e),n.style.display="none";var t="Sorry, there was an error processing your request.";"AbortError"===e.name?t="Request timed out. Please try again.":e.message.includes("SSL_PROTOCOL_ERROR")?t="There was a secure connection error. Please ensure the server supports HTTPS.":e.message.includes("Failed to fetch")&&(t="Unable to connect to the server. Please check your internet connection and try again."),this.addMessage(t,"bot",!0),this.storageManager.saveMessage(t,"bot"),this.config.onError&&this.config.onError(e)}},{key:"updateUIForSending",value:function(e,n){this.addMessage(n.value.trim(),"user"),this.storageManager.saveMessage(n.value.trim(),"user"),n.value="",e.style.display="block",this.isWaitingForResponse=!0,this.disableSendingFunctionality()}},{key:"resetUIAfterSending",value:function(e){this.isWaitingForResponse=!1,this.isTypewriterActive||this.enableSendingFunctionality(),e.style.display="none"}},{key:"loadChatHistory",value:function(){var e=this;if(this.widget){var n=this.widget.querySelector(".chat-messages"),t=n.querySelectorAll(".message-row"),r=n.querySelector("#greeting-row");t.forEach((function(e){e!==r&&e.remove()})),this.storageManager.getChatHistory().reduce((function(e,n){if("user"===n.sender)e.push(n);else if("bot"===n.sender){var t=e.findLastIndex((function(e){return"user"===e.sender}));-1!==t&&(e=e.filter((function(e,n){return n<=t||"user"===e.sender}))),e.push(n)}return e}),[]).forEach((function(n){e.addMessage(n.message,n.sender,!1)}))}}},{key:"updateConfig",value:function(e){this.initConfig(i(i({},this.config),e)),this.destroy(),this.createWidget(),this.setupEventListeners(),this.loadChatHistory()}},{key:"destroy",value:function(){this.removeActiveForm()}},{key:"setupEraseButton",value:function(){var e=this.widget.querySelector(".erase-chat");e&&(e.removeEventListener("click",this.eraseChat.bind(this)),e.addEventListener("click",this.eraseChat.bind(this)))}},{key:"eraseChat",value:function(){var e=this;if(confirm("Are you sure you want to clear the chat history? This action cannot be undone.")){var n=this.widget.querySelector(".erase-chat");n.style.opacity="0.5",n.disabled=!0;try{var t=this.widget.querySelector(".chat-messages"),r=t.querySelectorAll(".message-row");t.querySelector("#greeting-row"),r.forEach((function(e){"greeting-row"!==e.id&&e.remove()})),this.storageManager.clearHistory(),this.config.deleteEndpoint&&this.deleteBackendHistory().then((function(){console.log("Backend history deleted successfully")})).catch((function(n){console.error("Failed to delete backend history:",n),e.addMessage("Note: Failed to delete server history. Please try again later.","bot",!1)})),t.querySelector("#greeting-row")||this.addGreetingMessage();var i=this.widget.querySelector(".chat-input input");i&&(i.value=""),console.log("Chat history cleared successfully")}catch(e){console.error("Error during chat erasure:",e),this.addMessage("Failed to clear chat history. Please try again.","bot",!1)}finally{n.style.opacity="1",n.disabled=!1}}}},{key:"addGreetingMessage",value:function(){var e=this.widget.querySelector(".chat-messages");if(!e.querySelector("#greeting-row")){var n=document.createElement("div");n.className="message-row",n.id="greeting-row";var t=document.createElement("div");t.className="message bot-message greeting-message",t.textContent=this.config.greeting,n.appendChild(t),e.insertBefore(n,e.firstChild)}}},{key:"setupResponsiveHandling",value:function(){var e,n=this,t=function(){var e=n.widget.querySelector(".chat-window"),t=n.widget.querySelector(".chat-toggle");if(e&&t){var r=function(){var e=window.innerHeight,n=window.innerWidth,t=Math.min(Math.max(.3*n,320),600),r=Math.min(Math.max(.7*e,400),800);n<=480?(t=n,r=e,r=e-parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")||"0")):n<=768?(t=Math.min(.8*n,400),r=Math.min(.8*e,600)):n<=1024?(t=Math.min(.35*n,420),r=Math.min(.7*e,580)):n<=1366?(t=Math.min(.3*n,450),r=Math.min(.75*e,600)):n<=1920?(t=Math.min(.25*n,500),r=Math.min(.8*e,700)):(t=Math.min(.2*n,600),r=Math.min(.8*e,800)),t=Math.max(t,320),r=Math.max(r,400);var i=e-(n<=480?0:120);return{width:t,height:r=Math.min(r,i)}}(),i=r.width,o=r.height,s=(window.innerHeight,window.innerWidth);if(e.style.width="".concat(i,"px"),e.style.height="".concat(o,"px"),s<=480)e.style.bottom="0",e.style.right="0",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.borderRadius="0",e.style.maxHeight="100%",e.style.transform="none";else{var c=w[n.config.position];Object.entries(c.window).forEach((function(n){var t=a(n,2),r=t[0],i=t[1];e.style[r]=i}))}var l=Math.min(Math.max(.04*i,14),16);e.style.fontSize="".concat(l,"px");var d=e.querySelector(".chat-messages"),h=e.querySelector(".chat-input-container");if(d){var u=Math.min(Math.max(.03*i,8),16);d.style.padding="".concat(u,"px");var p=e.querySelector(".chat-header").offsetHeight,g=h?h.offsetHeight:0;d.style.height="calc(100% - ".concat(p+g,"px)")}if(h){var m=Math.min(Math.max(.03*i,8),16);h.style.padding="".concat(m,"px")}}};(e=document.createElement("style")).innerHTML="\n                :root {\n                    --sab: env(safe-area-inset-bottom);\n                    --sat: env(safe-area-inset-top);\n                    --sal: env(safe-area-inset-left);\n                    --sar: env(safe-area-inset-right);\n                }\n            ",document.head.appendChild(e),t(),window.addEventListener("resize",y(t,250)),window.addEventListener("orientationchange",(function(){setTimeout(t,100)}));var r=new ResizeObserver(y((function(){var e=n.widget.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight)}),100)),i=this.widget.querySelector(".chat-window");i&&r.observe(i)}},{key:"scrollChatToBottom",value:function(){var e=this.widget.querySelector(".chat-messages");if(e){var n,t,r,i,o=e.scrollTop;e.scrollHeight-e.clientHeight-o<100&&(requestAnimationFrame((function(){e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})),null===(n=event)||void 0===n||null===(t=n.preventDefault)||void 0===t||t.call(n),null===(r=event)||void 0===r||null===(i=r.stopPropagation)||void 0===i||i.call(r))}}},{key:"setupScrollContainment",value:function(){var e=this.widget.querySelector(".chat-messages");if(e){e.addEventListener("wheel",(function(n){if(e.scrollHeight>e.clientHeight){n.stopPropagation();var t=n.deltaY<0,r=n.deltaY>0,i=0===e.scrollTop,o=e.scrollTop+e.clientHeight>=e.scrollHeight;(t&&i||r&&o)&&n.preventDefault()}}),{passive:!1});var n=0;e.addEventListener("touchstart",(function(e){n=e.touches[0].clientY}),{passive:!0}),e.addEventListener("touchmove",(function(t){var r=t.touches[0].clientY>n,i=e.scrollTop<=0,o=e.scrollTop+e.clientHeight>=e.scrollHeight;(r&&i||!r&&o)&&t.preventDefault()}),{passive:!1})}}},{key:"deleteBackendHistory",value:function(){var e=this.userManager.currentUser,n=this.userManager.domain;return fetch(this.config.deleteEndpoint,{method:"DELETE",headers:i(i({},this.config.apiHeaders),{},{"Content-Type":"application/json"}),body:JSON.stringify({userId:e,domain:n})}).then((function(e){if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return e.json()}))}},{key:"scrollToTypingIndicator",value:function(){var e=this.widget.querySelector(".chat-messages"),n=this.widget.querySelector(".typing-indicator");e&&n&&requestAnimationFrame((function(){var t={top:e.scrollHeight,behavior:"smooth"};e.scrollTo(t),n.scrollIntoView({behavior:"smooth",block:"end"})}))}},{key:"setupMessageActions",value:function(e,n){var t=this,r=e.querySelector(".copy-btn"),i=e.querySelector(".like-btn"),o=e.querySelector(".dislike-btn"),a=e.querySelector(".regenerate-btn"),s=e.querySelector(".bot-message");r.addEventListener("click",(function(){navigator.clipboard.writeText(s.textContent).then((function(){r.classList.add("copied"),r.innerHTML="\n                    <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E\" alt=\"✓\">\n                ",setTimeout((function(){r.classList.remove("copied"),r.innerHTML="\n                        <img src=\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z'/%3E%3C/svg%3E\" alt=\"Copy\">\n                    "}),2e3)}))})),i.addEventListener("click",(function(){var e=i.classList.contains("active");i.classList.remove("active"),o.classList.remove("active"),e?t.sendFeedback("remove",n):(i.classList.add("active"),t.sendFeedback("like",n))})),o.addEventListener("click",(function(){var e=o.classList.contains("active");i.classList.remove("active"),o.classList.remove("active"),e?t.sendFeedback("remove",n):(o.classList.add("active"),t.sendFeedback("dislike",n))})),a.addEventListener("click",h(l().mark((function n(){var r,i,o,a,s,c,d;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.isWaitingForResponse){n.next=21;break}r=Array.from(t.widget.querySelectorAll(".message-row")),i=r.findIndex((function(n){return n.contains(e)})),o="",a=-1,s=i-1;case 6:if(!(s>=0)){n.next=15;break}if(!(c=r[s].querySelector(".user-message"))){n.next=12;break}return o=c.textContent,a=s,n.abrupt("break",15);case 12:s--,n.next=6;break;case 15:if(!o||-1===a){n.next=21;break}for(d=r.length-1;d>a;d--)r[d].remove();return n.next=19,t.updateStorageAfterRegeneration(a,o);case 19:return n.next=21,t.sendMessage(o,!0);case 21:case"end":return n.stop()}}),n)}))))}},{key:"updateLastBotMessage",value:function(){var e=this.widget.querySelectorAll(".bot-message-container");e.forEach((function(n,t){n.classList.remove("last"),t===e.length-1&&n.classList.add("last")}))}},{key:"updateStorageAfterRegeneration",value:(r=h(l().mark((function e(n,t){var r,i,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.userManager.getHistoryKey(),i=this.storageManager.getChatHistory(),o=-1,a=-1,s=0;case 5:if(!(s<i.length)){e.next=14;break}if("user"!==i[s].sender){e.next=11;break}if(++a!==n){e.next=11;break}return o=s,e.abrupt("break",14);case 11:s++,e.next=5;break;case 14:-1!==o&&((i=i.slice(0,o+1))[o].regenerated=!0,localStorage.setItem(r,JSON.stringify(i)));case 15:case"end":return e.stop()}}),e,this)}))),function(e,n){return r.apply(this,arguments)})},{key:"sendFeedback",value:(n=h(l().mark((function e(n,t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={type:n,response:t,feedback:null,timestamp:(new Date).toISOString(),userId:this.userManager.currentUser,domain:this.userManager.domain},e.next=4,fetch(this.config.feedbackEndpoint,{method:"POST",headers:i({"Content-Type":"application/json"},this.config.apiHeaders),body:JSON.stringify(r)});case 4:if(e.sent.ok){e.next=7;break}throw new Error("Failed to send feedback");case 7:this.saveFeedbackState(t,n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error sending feedback:",e.t0);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t){return n.apply(this,arguments)})},{key:"saveFeedbackState",value:function(e,n){var t="feedback_".concat(this.userManager.currentUser),r=JSON.parse(localStorage.getItem(t)||"{}");"remove"===n?delete r[e]:r[e]=n,localStorage.setItem(t,JSON.stringify(r))}},{key:"restoreFeedbackState",value:function(e,n){var t="feedback_".concat(this.userManager.currentUser),r=JSON.parse(localStorage.getItem(t)||"{}")[n];if(r){var i=e.querySelector(".like-btn"),o=e.querySelector(".dislike-btn");"like"===r?(i.classList.add("active"),o.classList.remove("active")):"dislike"===r&&(o.classList.add("active"),i.classList.remove("active"))}}},{key:"checkForTriggerWords",value:function(e){var n;if(null===(n=this.config.hubspot)||void 0===n||!n.enabled)return!1;if(this.userManager.hasSubmittedForm())return!1;if(this.isFormActive())return!1;var t=e.toLowerCase().split(/\s+/);return this.config.hubspot.triggerKeywords.some((function(e){return t.includes(e.toLowerCase())}))}},{key:"isFormActive",value:function(){return!!this.activeForm||!!this.widget.querySelector(".hubspot-form-container")}},{key:"showHubSpotForm",value:function(){var e;if(null!==(e=this.config.hubspot)&&void 0!==e&&e.enabled&&!this.userManager.hasSubmittedForm()&&!this.isFormActive()){this.disableChatFunctionality(),this.widget.querySelectorAll(".hubspot-form-row").forEach((function(e){return e.remove()}));var n=document.createElement("div");n.className="message-row hubspot-form-row",n.innerHTML='\n            <div class="hubspot-form-container" style="opacity: 0; transform: translateY(20px);">\n                <div class="form-header">\n                    <h3>Contact Us</h3>\n                    <p>Please fill out the form below and we\'ll get back to you shortly.</p>\n                </div>\n                <form id="hubspotForm" class="hubspot-form">\n                    <div class="form-group">\n                        <label for="fullname">Full Name *</label>\n                        <input type="text" id="fullname" name="fullname" required \n                               placeholder="Enter your full name">\n                        <div id="fullname-error" class="error-message"></div>\n                    </div>\n                    <div class="form-group">\n                        <label for="email">Email Address *</label>\n                        <input type="email" id="email" name="email" required \n                               placeholder="Enter your email">\n                        <div id="email-error" class="error-message"></div>\n                    </div>\n                    <div class="form-group">\n                        <label for="phone">Phone Number *</label>\n                        <input type="tel" id="phone" name="phone" required \n                               placeholder="Enter your phone number">\n                        <div id="phone-error" class="error-message"></div>\n                    </div>\n                    <button type="submit" id="submitButton">Submit</button>\n                </form>\n            </div>\n        ';var t=this.widget.querySelector(".chat-messages"),r=this.widget.querySelector(".typing-indicator");t.insertBefore(n,r),this.activeForm=n;var i=document.createElement("style");i.textContent="\n            .hubspot-form-container {\n                background: #fff;\n                padding: 20px;\n                border-radius: 12px;\n                box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n                margin: 15px 0;\n                max-width: 100%;\n                border: 1px solid #e4e6eb;\n            }\n            \n            .form-header {\n                margin-bottom: 20px;\n                text-align: center;\n            }\n            \n            .form-header h3 {\n                margin: 0 0 8px 0;\n                color: #333;\n                font-size: 18px;\n            }\n            \n            .form-header p {\n                margin: 0;\n                color: #666;\n                font-size: 14px;\n            }\n            \n            .hubspot-form .form-group {\n                margin-bottom: 20px;\n            }\n            \n            .hubspot-form label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: 500;\n                color: #333;\n                font-size: 14px;\n            }\n            \n            .hubspot-form input {\n                width: 100%;\n                padding: 10px;\n                border: 1px solid #ddd;\n                border-radius: 6px;\n                font-size: 14px;\n                transition: border-color 0.3s ease;\n            }\n            \n            .hubspot-form input:focus {\n                outline: none;\n                border-color: var(--chat-primary-color);\n                box-shadow: 0 0 0 2px rgba(var(--chat-primary-color-rgb), 0.1);\n            }\n            \n            .hubspot-form input::placeholder {\n                color: #999;\n            }\n            \n            .hubspot-form .error-message {\n                color: #dc3545;\n                font-size: 12px;\n                margin-top: 4px;\n                min-height: 20px;\n            }\n            \n            .hubspot-form button {\n                background: var(--chat-primary-color);\n                color: white;\n                border: none;\n                padding: 12px 24px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-size: 16px;\n                font-weight: 500;\n                width: 100%;\n                transition: all 0.3s ease;\n            }\n            \n            .hubspot-form button:hover {\n                opacity: 0.9;\n                transform: translateY(-1px);\n            }\n            \n            .hubspot-form button:disabled {\n                opacity: 0.6;\n                cursor: not-allowed;\n                transform: none;\n            }\n            \n            .hubspot-form-success {\n                text-align: center;\n                padding: 20px;\n                background: #d4edda;\n                border-radius: 8px;\n                color: #155724;\n                margin: 10px 0;\n            }\n        ",document.head.appendChild(i),requestAnimationFrame((function(){var e=n.querySelector(".hubspot-form-container");e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="1",e.style.transform="translateY(0)"})),setTimeout((function(){n.scrollIntoView({behavior:"smooth",block:"center"})}),100);var o=n.querySelector("#hubspotForm");this.setupHubSpotFormHandlers(o)}}},{key:"setupHubSpotFormHandlers",value:function(e){var n=this,t=function(e){return/^[A-Za-z]+\s+[A-Za-z]+(\s+[A-Za-z]+)?$/.test(e.trim())},r=function(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.trim())},i=function(e){var n=e.replace(/\D/g,"");return n.length>=7&&n.length<=20};e.querySelector("#fullname").addEventListener("input",(function(){e.querySelector("#fullname-error").textContent=t(this.value)?"":"Please enter your full name"})),e.querySelector("#email").addEventListener("input",(function(){e.querySelector("#email-error").textContent=r(this.value)?"":"Please enter a valid email"})),e.querySelector("#phone").addEventListener("input",(function(){e.querySelector("#phone-error").textContent=i(this.value)?"":"Please enter a valid phone number"})),e.addEventListener("submit",function(){var o=h(l().mark((function o(a){var s,c,d,h,u,p;return l().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a.preventDefault(),(s=e.querySelector("#submitButton")).disabled=!0,s.textContent="Submitting...",c=e.querySelector("#fullname").value,d=e.querySelector("#email").value,h=e.querySelector("#phone").value,t(c)&&r(d)&&i(h)){o.next=11;break}return s.disabled=!1,s.textContent="Submit",o.abrupt("return");case 11:return o.prev=11,o.next=14,n.submitToHubSpot({firstName:c.split(" ")[0],lastName:c.split(" ").slice(1).join(" "),email:d,phone:h.replace(/\D/g,"")});case 14:if(!o.sent.ok){o.next=22;break}n.userManager.recordFormSubmission({firstName:c.split(" ")[0],lastName:c.split(" ").slice(1).join(" "),email:d,phone:h.replace(/\D/g,"")}),n.activeForm=null,(u=n.widget.querySelector(".hubspot-form-container"))&&(u.style.transition="opacity 0.3s ease",u.style.opacity="0",setTimeout((function(){u.innerHTML='\n                                <div class="hubspot-form-success" style="opacity: 0; transform: translateY(10px)">\n                                    <h3>Thank you for your submission!</h3>\n                                    <p>We\'ll get back to you shortly.</p>\n                                </div>\n                            ',requestAnimationFrame((function(){var e=u.querySelector(".hubspot-form-success");e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="1",e.style.transform="translateY(0)"}))}),300),setTimeout((function(){n.enableChatFunctionality(),setTimeout((function(){var e=u.closest(".message-row");e&&(e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="0",e.style.transform="translateY(-20px)",setTimeout((function(){e.remove(),n.activeForm=null}),300))}),2e3)}),1e3)),o.next=23;break;case 22:throw new Error("Submission failed");case 23:o.next=34;break;case 25:o.prev=25,o.t0=o.catch(11),console.error("HubSpot submission error:",o.t0),s.textContent="Error - Try Again",s.disabled=!1,(p=document.createElement("div")).className="error-message",p.textContent="Failed to submit form. Please try again.",e.appendChild(p);case 34:case"end":return o.stop()}}),o,null,[[11,25]])})));return function(e){return o.apply(this,arguments)}}())}},{key:"submitToHubSpot",value:(e=h(l().mark((function e(n){var t,r,i,o,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.hubspot,r=t.portalId,i=t.formGuid,o="https://api.hsforms.com/submissions/v3/integration/submit/".concat(r,"/").concat(i),a={submittedAt:Date.now(),fields:[{name:"firstname",value:n.firstName},{name:"lastname",value:n.lastName},{name:"email",value:n.email},{name:"phone",value:n.phone}],context:{pageUri:window.location.href,pageName:document.title}},e.abrupt("return",fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}));case 4:case"end":return e.stop()}}),e,this)}))),function(n){return e.apply(this,arguments)})},{key:"disableChatFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),n=this.widget.querySelector(".send-button"),t=this.widget.querySelectorAll(".chip");e.disabled=!0,n.disabled=!0,t.forEach((function(e){e.style.opacity="0.5",e.style.pointerEvents="none"})),e.closest(".chat-input-container").classList.add("disabled")}},{key:"enableChatFunctionality",value:function(){var e=this.widget.querySelector(".chat-input input"),n=this.widget.querySelector(".send-button"),r=this.widget.querySelectorAll(".chip");[e,n].concat(t(r)).forEach((function(e,n){setTimeout((function(){e.disabled=!1,e.style.opacity="1",e.style.pointerEvents="auto"}),100*n)})),e.closest(".chat-input-container").classList.remove("disabled")}},{key:"removeActiveForm",value:function(){this.activeForm&&(this.activeForm.remove(),this.activeForm=null,this.enableChatFunctionality())}}]);var e,n,r,s,c,d}(),v=function(){return g((function e(n){u(this,e),this.config=n,this.domain=this.getCurrentDomain(),this.path=this.getCurrentPath(),this.currentUser=this.generateUserId(),this.initializeUser(),this.formSubmissionsKey="chatFormSubmissions_".concat(this.domain),this.initializeFormSubmissions()}),[{key:"getCurrentDomain",value:function(){return window.location.hostname}},{key:"getCurrentPath",value:function(){return window.location.pathname}},{key:"generateUserId",value:function(){var e=this.config.separateSubpageHistory?"currentChatUser_".concat(this.domain).concat(this.path):"currentChatUser_".concat(this.domain),n=localStorage.getItem(e);if(!n){var t="user_".concat(this.domain).concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,5));return localStorage.setItem(e,t),t}return n}},{key:"getHistoryKey",value:function(){return this.config.separateSubpageHistory?"chatHistory_".concat(this.domain).concat(this.path):"chatHistory_".concat(this.domain)}},{key:"initializeUser",value:function(){var e=this.getHistoryKey();localStorage.getItem(e)||localStorage.setItem(e,JSON.stringify([]))}},{key:"initializeFormSubmissions",value:function(){localStorage.getItem(this.formSubmissionsKey)||localStorage.setItem(this.formSubmissionsKey,JSON.stringify([]))}},{key:"hasSubmittedForm",value:function(){return JSON.parse(localStorage.getItem(this.formSubmissionsKey)||"[]").includes(this.currentUser)}},{key:"recordFormSubmission",value:function(e){var n=JSON.parse(localStorage.getItem(this.formSubmissionsKey)||"[]");if(!n.includes(this.currentUser)){n.push(this.currentUser),localStorage.setItem(this.formSubmissionsKey,JSON.stringify(n));var t="chatFormData_".concat(this.currentUser);localStorage.setItem(t,JSON.stringify(i(i({},e),{},{submittedAt:(new Date).toISOString()})))}}},{key:"loadUserData",value:function(){var e=this.getHistoryKey();return{userId:this.currentUser,domain:this.domain,path:this.path,chatHistory:JSON.parse(localStorage.getItem(e))||[]}}}])}(),b=function(){return g((function e(n,t){u(this,e),this.userManager=n,this.config=t,this.maxHistoryLength=100,this.widget=null,this.domain=n.domain,this.path=n.path}),[{key:"setWidget",value:function(e){this.widget=e}},{key:"getChatHistory",value:function(){var e=this,n=this.userManager.getHistoryKey(),t=localStorage.getItem(n),r=t?JSON.parse(t):[];return this.config.separateSubpageHistory?r.filter((function(n){return!(n.domain&&n.domain!==e.domain||n.path&&n.path!==e.path)})):r.filter((function(n){return!n.domain||n.domain===e.domain}))}},{key:"saveMessage",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.userManager.getHistoryKey(),i=this.getChatHistory();if(t&&"bot"===n){var o=i.findLastIndex((function(e){return"user"===e.sender}));-1!==o&&(i=i.slice(0,o+1))}var a={message:e,sender:n,timestamp:(new Date).toISOString(),domain:this.domain,isRegenerated:t};this.config.separateSubpageHistory&&(a.path=this.path),i.push(a),i.length>this.maxHistoryLength&&(i=i.slice(-this.maxHistoryLength)),localStorage.setItem(r,JSON.stringify(i))}},{key:"loadChatHistory",value:function(){var e=this;if(this.widget){var n=this.widget.widget.querySelector(".chat-messages"),t=n.querySelectorAll(".message-row"),r=n.querySelector("#greeting-row");t.forEach((function(e){e!==r&&e.remove()})),this.getChatHistory().forEach((function(n){e.widget.addMessage(n.message,n.sender,!1)}))}}},{key:"clearHistory",value:function(){var e=this.userManager.getHistoryKey();try{localStorage.removeItem(e),localStorage.setItem(e,JSON.stringify([])),console.log("Local storage cleared successfully")}catch(e){console.error("Error clearing local storage:",e)}}}])}();function y(e,n){var t;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];clearTimeout(t),t=setTimeout((function(){clearTimeout(t),e.apply(void 0,i)}),n)}}e.exports?e.exports=f:window.EasyChatWidget=f;var w={"bottom-right":{toggle:{bottom:"20px",right:"20px",left:"auto",transform:"none"},window:{bottom:"100px",right:"20px",left:"auto",transform:"none"}},"bottom-left":{toggle:{bottom:"20px",left:"20px",right:"auto",transform:"none"},window:{bottom:"100px",left:"20px",right:"auto",transform:"none"}},"bottom-center":{toggle:{bottom:"20px",left:"50%",right:"auto",transform:"translateX(-50%)"},window:{bottom:"100px",left:"50%",right:"auto",transform:"translateX(-50%)"}}}}},n={},function t(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}(954);var e,n}));